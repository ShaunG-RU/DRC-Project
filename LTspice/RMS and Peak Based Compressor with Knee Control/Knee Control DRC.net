* C:\Users\shaun\Desktop\DRC-Project\LTspice\RMS and Peak Based Compressor with Knee Control\Knee Control DRC.asc
V2 +15V 0 +15V
V3 -15V 0 -15V
R1 N029 N028 47.6K
R2 N028 0 10K
XU1 signal_in_ac N028 +15V -15V N029 TL072
B1 signal_in 0 V=1.414*0.775*(10**({dBu_level}/20))*V(1V)
V4 1V 0 SINE(0 1 {freq})
R3 N020 N025 6.8K
R4 N021 N020 6.8K
D1 N026 N020 1N4148
D2 N021 N026 1N4148
R5 N027 N025 6.8K
R6 N027 N021 3.4K
R7 full_rect N027 6.8K
R8 N032 full_rect 4.2k
XU4 0 N032 +15V -15V full_rect_log TL072
V5 1Vramp 0 PULSE(-1 1 0 {1/(2*freq)} {1/(2*freq)} 0 {1/freq})
XU5 N029 N025 +15V -15V N025 TL072
XU2 0 N020 +15V -15V N026 LTC6244
XU3 0 N027 +15V -15V full_rect LTC6244
R9 N004 N003 4.2k
XU6 0 N004 +15V -15V thr_log TL072
XU8 0 N006 lin_thr pot T={threshold}
R10 +15V N006 5k
R11 N043 N057 2K
R12 N043 N065 2K
Q1 N057 N054 N069 0 2N3904
Q2 N065 0 N069 0 2N3904
V6 N043 0 5V
I1 N069 0 255.8µ
R13 N059 N065 100K
R14 N059 0 100K
R15 N044 N057 100K
R16 tanh_out N044 100K
R17 N022 full_rect_log 10K
R18 N038 0 10K
R19 N038 thr_log 10K
R20 full_rect_log_min_thr N022 10K
XU10 N038 N022 +15V -15V full_rect_log_min_thr TL072
XU9 N059 N044 +15V -15V tanh_out TL072
C3 tanh_out N044 0.2n V=25 Rser=0.2
XU13 lin_thr N003 +15V -15V N003 TL072
C4 full_rect_log_min_thr N022 0.3n V=50 Irms=0 Rser=0.1 Lser=0
C5 N015 0 0.1µ V=10 Irms=0 Rser=0.003 Lser=0
XU15 0 N011 +15V -15V gain_before_ratio TL072
B2 1Vmod 0 V=V(1V)*sin({modfreq}*2*pi*time)
R41 N041 N040 1k
R42 gain_after_ratio N042 1k
R43 0 N039 20
XU23 +5V N037 gain_before_ratio_inv N040 N041 tanh_out_clamp2_clip_buf -5V N039 gain_after_ratio 0 N042 VCA824 VCA824
R46 N037 N055 1k
C1 N055 0 0.1µ V=50 Irms=0 Rser=0.09 Lser=0
R47 N042 N049 4k
C2 N049 0 0.1µ
V8 +5V 0 5V
V12 -5V 0 -5V
XU24 0 N013 +15V -15V gain_before_ratio_inv TL072
R50 gain_before_ratio_inv N013 10k
R51 N013 gain_before_ratio 10k
R52 N023 0 100k
R53 N035 gain_before_ratio 100k
R54 N024 N023 100k
XU25 N035 N023 +15V -15V N024 TL072
R55 N035 gain_after_ratio 100k
R58 final N019 20K
C8 final N019 22p V=50 Irms=0 Rser=0.1601 Lser=520p mfg="Würth Elektronik" pn="885012008039 WCAP-CSGP 1206" type="NP0"
R59 N034 N033 20K
R60 final 0 10Meg
XU27 N036 N019 +15V -15V final TL072
V17 N036 0 0
XU28 N034 0 gain_final N031 0 +15V N019 THAT2180A THAT2180A
R61 -15V N031 5.1K
XU22 0 N053 +15V -15V N054 TL072
R65 N054 N053 {tanh_gain_in}
R66 N053 peak_AR_buf_tanh 10k
XU7 vratio_buf_inv N062 +15V -15V N063 TL072
R22 N062 tanh_out_clamp 10k
C6 tanh_out_clamp tanh_out_gain_inv 10µ Rser=0.09
D14 tanh_out_clamp N063 1N4148
XU29 0 N002 +15V -15V vratio_buf_inv TL072
R68 vratio_buf_inv N002 10k
R69 N002 vratio_buf 10k
XU30 tanh_out_clamp N046 +15V -15V N046 TL072
B3 gain_reduction 0 V=20*log10(abs(V(signal_in))) -20*log10(abs(V(final)))
B4 final_norm 0 V=V(final)/(1.414*0.775*(10**({dBu_level}/20)))
XU11 0 N005 vratio exppot R=1k T= 1/{ratio_ctrl} stiff=10000
R62 -15V N005 14k
XU31 vratio vratio_buf +15V -15V vratio_buf TL072
V9 NC_01 0 0V
R63 N037 0 100k
V10 1Vsquare 0 PULSE(-1 1 0 1e-6 1e-6 {duty/freq} {1/freq})
D12 N018 full_rect_log_min_thr_clip 1N4148
XU32 0 full_rect_log_min_thr_clip +15V -15V N018 LTC6244
R21 full_rect_log_min_thr_clip full_rect_log_min_thr_min_half_kw 1k
R72 gain_before_ratio N011 2k
R73 N011 peak_AR 10k
R74 N010 N009 30.808k
R75 N009 0 1k
R76 N052 N051 30.808k
R77 N051 0 1k
D19 N064 N070 1N4148
XU36 0 N064 +15V -15V N070 LTC6244
R78 N064 tanh_out_clamp2 1k
XU38 N064 tanh_out_clamp2_clip_buf +15V -15V tanh_out_clamp2_clip_buf TL072
XU12 0 N047 +15V -15V tanh_out_gain_inv TL072
R56 tanh_out_gain_inv N047 10k
R57 N047 tanh_norm 10k
XU18 0 N048 +15V -15V tanh_out_clamp2 TL072
R23 tanh_out_clamp2 N048 10k
R26 gain_final N030 35k
R40 N030 N024 10k
XU37 0 N030 +15V -15V gain_final LT1217
R67 N014 N010 250
XU14 full_rect_log_min_thr_clip N009 +15V -15V N010 LT1217
XU33 full_rect_log_min_thr_clip2 N051 +15V -15V N052 LT1217
V7 4dBu 0 AC 1.736
C11 0 N038 0.3n V=50 Irms=0 Rser=0.1 Lser=0
C12 lin_thr 0 1µ
C14 N059 0 0.2n V=25 Rser=0.2
C15 vratio 0 1µ
C16 N033 signal_in 10µ
C17 signal_in_ac signal_in 1µ
R80 signal_in_ac 0 200k
D4 N004 thr_log 1N4148
D8 N032 full_rect_log 1N4148
R81 gain_before_ratio_inv 0 100k
XU26 +5V -5V N049 pot T=.4917
XU39 +5V -5V N055 pot R=1meg T=.8029
R48 N061 N060 1k
R49 tanh_norm N066 1k
R82 0 N056 20
XU41 +5V N050 tanh_out_shift N060 N061 vratio_buf_sym -5V N056 tanh_norm 0 N066 VCA824 VCA824
R83 N050 N071 1k
C18 N071 0 0.1µ V=50 Irms=0 Rser=0.09 Lser=0
R84 N066 N074 4k
C19 N074 0 0.1µ
V19 vratio_buf_sym 0 SINE(0 0.1 50)
R85 N050 0 100k
R86 tanh_out_shift 0 100k
XU42 +5V -5V N074 pot T=.4917
XU43 +5V -5V N071 pot R=1meg T=.8033
R87 N048 N046 10k
V20 -0.5V 0 -0.5V
XU44 -0.5V N007 +15V -15V vratio_buf_sym TL072
R88 vratio_buf_sym N007 10k
R89 N007 vratio_buf 10k
R24 N045 0 10K
R25 N058 tanh_out 10K
R44 tanh_out_shift N045 10K
XU35 N058 N045 +15V -15V tanh_out_shift TL072
R45 N058 -0.5V 10K
D3 N073 full_rect_log_min_thr_clip2 1N4148
XU40 vhalf_kw full_rect_log_min_thr_clip2 +15V -15V N073 LTC6244
D5 full_rect_log_min_thr_clip2 N072 1N4148
XU45 vhalf_kw_inv full_rect_log_min_thr_clip2 +15V -15V N072 LTC6244
R71 full_rect_log_min_thr_clip2 full_rect_log_min_thr 1k
V11 1Vpulse 0 PULSE(0 1 20ms 1e-6 1e-6 0.1 0 1)
XU16 N016 peak_AR +15V -15V peak_AR TL072
D10 N014 N015 RB500SM-30
XU17 0 -0.5V vhalf_kw pot T={knee}
XU19 0 N001 +15V -15V vhalf_kw_inv TL072
C9 vhalf_kw 0 1µ
R30 vhalf_kw_inv N001 10k
R31 N001 vhalf_kw 10k
R32 N012 0 10K
R33 N017 full_rect_log_min_thr 10K
R36 full_rect_log_min_thr_min_half_kw N012 10k
XU21 N017 N012 +15V -15V full_rect_log_min_thr_min_half_kw TL072
R37 N017 vhalf_kw_inv 10K
R27 N015 0 {release}
XU20 N015 N008 +15V -15V N008 TL072
R28 N016 N008 {attack}
C10 N016 0 0.1µ V=10 Irms=0 Rser=0.003 Lser=0
XU46 N068 peak_AR_buf_tanh +15V -15V peak_AR_buf_tanh TL072
R29 N068 N067 {attack}
C13 N068 0 0.1µ V=10 Irms=0 Rser=0.003 Lser=0
XU47 vhalf_kw vhalf_kw_buf +15V -15V vhalf_kw_buf TL072
R34 N067 N052 250
.model D D
.lib C:\Users\shaun\AppData\Local\LTspice\lib\cmp\standard.dio
.model NPN NPN
.model PNP PNP
.lib C:\Users\shaun\AppData\Local\LTspice\lib\cmp\standard.bjt
* Conversion from 1V max to dBu_level.\nCircuit nominal is 4dBu
* 1V reference sine for tests
* PRECISION FULL WAVE RECTIFIER
* linear to log signal converter
* gain 5.76 so that we get 10V at 4dBU for rectifier stage
* op amp buffer to make output impedance as low as possible \nas the following rectifier stage is sensitive to it
* log stage transfer function Vout=   -Vt*ln(Vin/(Is*R))\nVt = diode thermal voltage, Is = diode saturation current\nthermal voltage depends on absolute temperature, which would go up with room temperature\nand high signal levels (more current flowing in the diodes = more heat)\nthermal management may be advised, ex: both diodes for signal and threshold could be termally\ncoupled.\nAlso advised to match both diodes
* linear to log threshold converter
* THRESHOLD POT
* out = full_rect_log - thr_log
* thr_log more negative = higher threshold\nwiper closer to 1 = lower threshold\nwiper closer to 0 = higher threshold
* LOG DOMAIN PEAK DETECTOR +  EXP A/R
* release potentiometer
* attack potentiometer
* input offset compensation
* output offset compensation
* RAILS
.param modfreq = {10}
.param freq = {20}
* What we have is a smooth transition between unity gain setpoint (0V), ratio = 1\nand set ratio voltage.
* 1V amplitude modulated sine for tests
* 1V triangle
* gain reduction quick&dirty (zoom to get rid of singularities)
.tran 0 0.2 1ms {1/sample_rate} uic
.param dBu_level = {4}
.param sample_rate = 44.1k
.options cshunt=1e-15
* TEST BENCH
* compressor output
* KNEE MANAGEMENT
* SIGNAL(dB) - THRESHOLD(dB) STAGE
* tanh() cell using a BJT differential pair
* tanh() saturation... low R65 looks more like sine. (very soft knee)\n very high R65 introduces high distortion at knee. (folding)
* RATIO POT
* clamp tanh_out_gain_inv output positive excursions to -vratio level (positive value).\nshould not happen unless tanh() current sink is above 247µA.\nthen,  tanh_out_gain_inv may go above -vratio.
* gain = gain_before_ratio*( 1 - 1/ratio)\ngain = gain_before_ratio + gain_before_ratio_inv/ratio  (gain_after_ratio_inv is negative)\ngain = gain_before_ratio + gain_after_ratio (gain_after_ratio is negative)
* AUDIO PATH VCA STAGE - FEEDFORWARD
;ac dec 10 20 100000
* 1V square
.param duty = {0.5}
* Here 0V level is threshold +kw/2. The point at which the compressor should start working\nwe clip signal under 0V
* lin_v = 15*(1-t)*10k/(10k +5k)
* the incentive to use a lin to log diode converter instead of a log pot is :\nuse the same transfer function. (make calibration easier)\nhave the thermal effect partially cancel each other (since both diode networks heat more or less\nthe same way, but that is assuming current is the same which is not because the threshold\ndiode  is subject to DC)
* The peak detector A/R stage contribution is made negligible by setting the fastest A/R possible,\nR=100 ohms for both\nwe ommit input gain = 5.76 because both vin and vthr use the same gain so it cancels out.\ntechnically we could ommit Is*R because they also cancel out...\n \nn*-Vt*ln(Vin/(Is*R))\n25.4mV*ln(Vin/(2nA*4.2k))\ndeltaVln = 25.4mV*ln(Vin/(2nA*4.2k)) - 25.4mV*ln(Vthr/(2nA*4.2k)) \ndeltaVln = 25.4mV*(ln(Vin/(2nA*4.2k)) - ln(Vthr/(2nA*4.2k)))\ndeltaVln = 25.4mV*(ln(Vin) - ln(Vthr)  -ln(2nA*4.2k) + ln(2nA*4.2k))\n \nnow convert ln2 to log10, hence the factor 2.303 and then to dBV...\n \ndeltaVllog = (25.4mV*2.303)*(log(Vin) - log(Vthr))\ndeltaVllog = (25.4mV*2.303)*(log(Vin) - log(Vthr))\ndbV = 20*log(V)\nwe want k*25.4mV*2.303 = 20\nk =20/(2.303-*25.4mV)\nk = 341.9\nand we also have THAT2180 1 dbV gain = 0.0061V\nthus final normalization gain = 341.9*0.0061 = 2.08559\nk = 2.08559
* use good audio cap here
* gain_final OUTPUT impedance should be as low as possible to drive THAT2180 properly\nZ_out << 50 Ohms.\ncompare that to TL072 125ohms open loop resistance.\nThat's why we use a high current low output impedance LT1217 Op Amp
* gain_in 1 + R74/R75 (here 30.808/1 +1 = 31.808) so that we renormalize to 10V max
* max log_min_thr (4dbU triangle signal, threshold -INF dB) =  0.31425V
* we're back to 0.314V max
* R67 current limiting resistor to protect U14
* R79 current limiting resistor to protect U33
* THEORY = 25.4mV*ln(Vin*5.76/(2nA*4.2k))\n 25.4mV*ln(10/(2nA*4.2k)) = 0.355325
* gain_before ratio has to stay under 1.6V !!! as per VCA824 datasheet
;.noise V(final) V7 dec 10 1 20000
* 0.1% or less
* 0.1% or less
* 0.1% or less
* 0.1% or less
* D8 and D4 must be matched and coupled thermally
* input offset compensation
* output offset compensation
* input signal amplitude could be as high as 10V
* symmetry point is 0.5V this is an inverting op amp with 0.5V reference symmetry.\nused to properly condition the gain signal of the VCA824 (U41) that performs tanh() normalization
* inverting op amp
* tanh() normalizer ( so that : vratio_buf < tanh_norm < 0V )\nthis assumes that the previous tanh() cell is well behaved and  -0.5V < tanh_out < 0.5V\nif not, the following clamping stage will take care of unwanted excursions.
* a bit of extra precaution so that VG fed to the U23 VCA824 never goes above 0V.\ntanh() normalization and clamping action is not perfect, as well as U41 VCA824 always \nhas some offset despite calibration, so we clip above 0V here.\nclamping is also required if tanh() current source is also set above 247µA
* tweak 200 < R65 < 1.5k
.param bw = {0.05}
* here we clip signal under -kw/2 and above kw/2 0V is threshold
* bw is the threshold bandwidth for soft/hard knee application
* setting I1 above 247µA gives a tanh() output that is no more bound from [-0.5V to 0.5V]\nNormalization and shifting to 0.5 is no more sufficient to set final ratio signal inside [vratio, 0V] range. \nhowever, clamping at -vratio and clipping at 0V before the U23 VCA824 make the\ncircuit compensated once again should that happen.
* 1V square pulse
* for testing A/R constants
* account for diode drop in final gain.
* attack range 100 - 10k\nrelease range 10k - 10Meg
* RATIO = 1/T\nvratio =  T - 1
* GAIN COMPUTER (U23 with variable ratio for knee management and U25 for final gain)
* FINAL GAIN NORMALIZATION
* CURRENT TO VOLTAGE
* CURRENT LIMITING
* KNEE WIDTH POT
* KW = 1 - T
* We offset down the selected threshold by half knee width.\nThis to ensure smooth knee application, so that the gain computer and knee width start\nworking at the same levels
* decoupling A/R with diodes is one way to do it, but it introduces a diode voltage drop.\nIt is mainly experimental. The more standard way is to use separate attack/release stages\nseparated by a buffer
* the sidechain and the audio path branches before the capacitor and each uses different caps\nit may create phase problems. You can try using a single cap.
* quite experimental. may introduce distortion for small knee widths (hard knee = distortion)\nthis is because of the use of the tanh() function
.param knee=0.95
.param ratio_ctrl=100
.param threshold = 0.5
* LP filter potentiometer
.param attack = 100
.param release = 100
* COMPRESSOR PARAMETERS
;.step param knee 0.85 0.98 0.02
;.step param ratio_ctrl 1 50 5
;.step param attack 0.3 1 0.1
.step dec param tanh_gain_in 100 10000 3
.param tanh_gain_in = 4000
* 35.3456k
* ratio_ctrl not the actual ratio
* APPROXIMATIVE TABLE :\nratio_ctrl      ratio\n6                 1.31\n11                1.85\n16                2.47\n21                3.22\n26                4.11\n31                5.22\n36                6.25\n41                8.4\n46                10.2\n51                 12.2
;.step param threshold 0.1 1 0.1
* www.skynext.tech
* Author : R.Verissimo
* release 0.91 05/09/2023
.SUBCKT pot 1 2 3 T=0.5 R=10k
.param tap={limit(T,1m,.999)}
R0 1 3 {R*(1-tap)}
R1 3 2 {R*tap}
.ENDS
.SUBCKT exppot 1 2 3 T=0.5
.param tap={limit(T,1m,.999)}
.param stiff={limit(stiff,1,10000)}
R0 1 3 {R*exp(-tap*ln(R*stiff))}
R1 3 2 {R*(1-exp(-tap*ln(R*stiff)))}
.ENDS
*                 Iin
*                  |  Ec+
*                  |   |   Ec-
*                  |   |   |  Vee
*                  |   |   |   |  GND
*                  |   |   |   |   |  Vcc
*                  |   |   |   |   |   |  Iout
*                  |   |   |   |   |   |   |
.SUBCKT THAT2180A  1   2   3   4   5   6   7
*
*
*
R1         10 13  2.5k
R2         10 14  2.5k
I1         10 29 DC 50uA
R3         11 7  8k
R4         12 7  8k
G1         7 15 11 12 1.25e-4
R5         0 15  10MEG
R6         0 16  10k
C1         16 15  10p
R7         19 7  2k
G2         19 20 15 0 5e-4
C2         19 7  8p
E1         20 28 30 6 2
R8         5 29  1.7k
V1         0 29 DC 2.1V
I2         0 30 DC 20uA
R9         4 2  27
C3         20 0  12p
I3         20 28 DC 220uA
V2         18 0 DC .7V
V3         17 15 DC 1.4V
Q1         11 1 13 QNHIB
Q2         12 9 14 QNHIB
Q3         20 21 23 QNPNNOM
Q4         20 22 24 QNPNNOM
Q5         8 4 27 QNPNNOM
Q6         1 25 26 QNPNNOM
Q7         1 2 23 QPNPNOM
Q8         8 3 24 QPNPNOM
Q9         28 28 27 QPNPNOM
Q10        28 28 26 QPNPNOM
Q11        28 29 5 QNPNNOM
Q12        30 30 31 QNPNNOM
Q13        0 0 31 QPNPNOM
D1         18 15 DNOM
D2         17 7 DNOM
R10        3 25  20
R11        22 20 20
R12        21 20 27
Vos        9 6 DC 3mV
Isym       0 4 DC -420nA
*    Isym = -420nA for typical THD.  Set to -1uA for worst case THD.
.model qnpnnom npn (is=1e-15 bf=200, vaf=110, cjc=3pF)
.model qpnpnom pnp (is=1e-15 bf=100, vaf=85, cjc=5pf)
.model qnhib npn (bf=16000)
.model dnom d (is=1e-15)
.ENDS
*                      Positive Supply
*                      |   Gain Control
*                      |   |   Non-Inverting Input
*                      |   |   |   Gain Setting Resistor Terminals
*                      |   |   |     |   |  Inverting Input
*                      |   |   |     |   |    |  Negative Supply
*                      |   |   |     |   |    |   |  Reference Voltage
*                      |   |   |     |   |    |   |   |  Output
*                      |   |   |     |   |    |   |   |    |
*                      |   |   |     |   |    |   |   |    |    Feedback
*                      |   |   |     |   |    |   |   |    |      |
.SUBCKT VCA824 +Vcc VG +Vin +Rg -Rg -Vin -Vcc Vref Out Gnd FB
X_U5_F8    U5_N00257 U5_N00297 N09821 -VCC VCA82X_BIAS_U5_F8
X_U5_F1    U5_N00167 U5_N00177 +VCC N06304 VCA82X_BIAS_U5_F1
V_U5_V1         U5_N00167 U5_N00195 0.433V
E_U5_E1         U5_N00195 -VCC +VCC -VCC 0.5
X_U5_F6    U5_N00297 U5_N00251 N08923 -VCC VCA82X_BIAS_U5_F6
X_U5_F3    U5_N00177 U5_N00183 +VCC N08572 VCA82X_BIAS_U5_F3
X_U5_F4    U5_N00183 U5_N00189 +VCC N08740 VCA82X_BIAS_U5_F4
X_U5_F2    U5_N00189 U5_N00257 +VCC N10100 VCA82X_BIAS_U5_F2
X_U5_F5    U5_N00251 U5_N00205 N07015 -VCC VCA82X_BIAS_U5_F5
R_U5_R3         U5_N00195 U5_N00205  1k
Q_U6_Q24         N06304 U6_N16946 U6_N15431 NPN8 {x1}
R_U6_R15         U6_N26012 +VCC  300
R_U6_R20         U6_N49467 U6_N46592  100
R_U6_R24         -VIN U6_N336522  150
Q_U6_Q23         U6_N00503 U6_N16946 U6_N13215 NPN8 {x6}
C_U6_C3         U6_N334753 U6_N334801  10m  TC=0,0
C_U6_C1         U6_N00709 U6_N22036  0.5p
Q_U6_Q28         U6_N22036 U6_N07222 U6_N26012 PNP8 {x6}
Q_U6_Q29         U6_N07222 U6_N07222 U6_N612661 PNP8 {x2}
Q_U6_Q37         U6_N49467 U6_N16946 U6_N49758 NPN8 {x6}
R_U6_R13         -VCC U6_N19410  2k
D_U6_U1         U6_N334753 U6_N334759 dn3
R_U6_R21         U6_N57293 +VCC  300
Q_U6_Q30         N07015 U6_N07222 U6_N29549 PNP8 {x2}
R_U6_R18         -VCC U6_N36767  160
R_U6_R25         U6_N3853581 +RG  10
Q_U6_Q32         +RG U6_N16946 U6_N36767 NPN8 {x6}
E_U6_E1         U6_N00709 -VCC +VCC -VCC 0.5
R_U6_R23         +VIN U6_N336330  150
Q_U6_Q36         U6_N46276 U6_N46276 U6_N46592 NPN8 {x14}
I_U6_I1         U6_N334759 U6_N334753 DC 1.5u
Q_U6_Q26         U6_N16946 U6_N16946 U6_N19410 NPN8 {x2}
Q_U6_Q25         +VCC N06304 U6_N16946 NPN8 {x2}
Q_U6_Q40         U6_N42606 U6_N07222 U6_N57293 PNP8 {x6}
Q_U6_Q22         U6_N04782 U6_N04782 U6_N10900 NPN8 {x14}
Q_U6_Q21         +VCC U6_N336330 U6_N04782 NPN8 {x14}
R_U6_R14         U6_N612661 +VCC  2k
R_U6_R17         -VCC U6_N13215  160
Q_U6_Q34         +VCC U6_N336522 U6_N46276 NPN8 {x14}
Q_U6_Q33         N08372 U6_N22036 +RG NPN8 {x14}
R_U6_R22         -VCC U6_N51427  160
E_U6_E2         U6_N334759 -VCC +VCC -VCC 0.5
R_U6_R19         -VCC U6_N49758  160
Q_U6_Q27         U6_N22036 +RG U6_N00503 NPN8 {x14}
Q_U6_Q31         -VCC N07015 U6_N07222 PNP8 {x2}
C_U6_C2         U6_N00709 U6_N42606  0.5p
Q_U6_Q38         U6_N42606 -RG U6_N49467 NPN8 {x14}
X_U6_F1    U6_N334801 U6_N334759 U6_N336330 U6_N334759
+  VCA82X_INPUT_BUFFER_U6_F1
R_U6_R11         U6_N29549 +VCC  900
E_U6_E4         U6_N3853202 -VCC +VCC -VCC 0.5
Q_U6_Q39         -RG U6_N16946 U6_N51427 NPN8 {x6}
R_U6_R16         U6_N00503 U6_N10900  100
R_U6_R12         -VCC U6_N15431  955
Q_U6_Q35         N08468 U6_N42606 -RG NPN8 {x14}
C_U6_C5         U6_N3853202 U6_N3853581  0.88p  TC=0,0
R_U7_R27         -VCC U7_N01059  800
Q_U7_Q56         U7_N65219 U7_N65219 U7_N64914 NPN8 {x4}
Q_U7_Q60         U7_N107420 U7_N89137 U7_N81704 NPN8 {x12}
Q_U7_Q86         U7_N168308 U7_N167450 U7_N168596 NPN8 {x16}
Q_U7_Q77         U7_N137141 U7_N137141 U7_N142127 PNP8 {x16}
R_U7_R25         GND U7_N89137  50
R_U7_R23         -VCC U7_N01019  100
Q_U7_Q59         U7_N86791 U7_N65219 U7_N01059 NPN8 {x1}
R_U7_R28         -VCC U7_N01061  200
R_U7_R32         GND U7_N160714  50
R_U7_R17         -VCC U7_N55967  100
R_U7_R37         U7_N145504 +VCC  110
Q_U7_Q45         U7_N34597 U7_N34597 U7_N34298 PNP8 {x12}
Q_U7_Q87         U7_N167450 U7_N167450 U7_N168824 NPN8 {x16}
Q_U7_Q84         U7_N165781 U7_N165781 U7_N168308 NPN8 {x16}
Q_U7_Q62         U7_N01231 U7_N65219 U7_N01061 NPN8 {x4}
R_U7_R11         U7_N34298 +VCC  160
Q_U7_Q79         U7_N01317 U7_N142759 U7_N145504 PNP8 {x16}
Q_U7_Q80         N08740 U7_N01231 U7_N137141 PNP8 {x16}
Q_U7_Q52         U7_N53649 U7_N65219 U7_N55659 NPN8 {x8}
R_U7_R22         U7_N81704 U7_N82314  1k
Q_U7_Q49         U7_N01387 U7_N01387 U7_N37408 PNP8 {x12}
R_U7_R21         U7_N01001 +VCC  740
Q_U7_Q78         U7_N142759 U7_N142759 U7_N145276 PNP8 {x16}
R_U7_R13         U7_N1695201 VG  50
Q_U7_Q61         U7_N116536 U7_N86791 U7_N82314 NPN8 {x12}
Q_U7_Q88         N08740 U7_N160714 N08923 NPN8 {x2}
Q_U7_Q65         U7_N01387 U7_N01387 U7_N107420 NPN8 {x12}
Q_U7_Q63         U7_N01317 U7_N65219 U7_N01207 NPN8 {x4}
R_U7_R34         U7_N142127 +VCC  110
Q_U7_Q85         FB U7_N165781 U7_N167450 NPN8 {x16}
R_U7_R39         N08923 U7_N1690600  50
Q_U7_Q70         U7_N119904 U7_N119904 U7_N122147 PNP8 {x16}
R_U7_R29         -VCC U7_N01207  200
Q_U7_Q55         N08572 U7_N65219 U7_N67656 NPN8 {x2}
Q_U7_Q71         U7_N122683 U7_N122683 U7_N119904 PNP8 {x16}
R_U7_R31         -VCC U7_N168596  200
Q_U7_Q68         U7_N116528 U7_N116512 U7_N01001 PNP8 {x12}
Q_U7_Q69         U7_N116536 U7_N116536 U7_N116528 PNP8 {x12}
Q_U7_Q74         U7_N122683 U7_N01351 N08468 NPN8 {x16}
R_U7_R26         U7_N86791 GND  4.1k
R_U7_R24         -VCC U7_N01017  100
Q_U7_Q57         U7_N81704 U7_N65219 U7_N01017 NPN8 {x8}
R_U7_R38         U7_N122147 +VCC  110
Q_U7_Q47         U7_N37110 U7_N34597 U7_N34058 PNP8 {x12}
Q_U7_Q51         U7_N01387 U7_N45862 U7_N53649 NPN8 {x12}
Q_U7_Q46         U7_N01351 U7_N37408 U7_N34597 PNP8 {x12}
Q_U7_Q50         U7_N01351 U7_N1695201 U7_N51592 NPN8 {x12}
R_U7_R18         -VCC U7_N55659  100
Q_U7_Q81         FB U7_N01317 U7_N142759 PNP8 {x16}
R_U7_R16         -VCC U7_N67656  400
R_U7_R15         U7_N51592 U7_N53649  1k
Q_U7_Q66         U7_N116512 U7_N116512 U7_N01003 PNP8 {x12}
R_U7_R35         U7_N145276 +VCC  110
Q_U7_Q72         U7_N122683 U7_N01351 N08372 NPN8 {x16}
R_U7_R19         -VCC U7_N64914  1.4k
Q_U7_Q58         U7_N82314 U7_N65219 U7_N01019 NPN8 {x8}
R_U7_R30         -VCC U7_N168824  200
R_U7_R20         U7_N01003 +VCC  740
R_U7_R12         U7_N34058 +VCC  160
Q_U7_Q53         U7_N51592 U7_N65219 U7_N55967 NPN8 {x8}
Q_U7_Q76         U7_N01231 U7_N137141 U7_N141896 PNP8 {x16}
Q_U7_Q54         +VCC N08572 U7_N65219 NPN8 {x4}
Q_U7_Q67         U7_N107420 U7_N116536 U7_N116512 PNP8 {x12}
R_U7_R36         U7_N141896 +VCC  110
R_U7_R33         U7_N142127 U7_N145276  2k
Q_U7_Q73         U7_N01231 U7_N01387 N08372 NPN8 {x16}
Q_U7_Q75         U7_N01317 U7_N01387 N08468 NPN8 {x16}
Q_U7_Q48         U7_N37408 U7_N37408 U7_N37110 PNP8 {x12}
Q_U7_Q64         U7_N01351 U7_N01351 U7_N107420 NPN8 {x12}
R_U7_R14         GND U7_N45862  50
Q_U7_Q82         U7_N165781 U7_N1690600 N08740 PNP8 {x16}
Q_U8_Q38         U8_N01099 U8_N38844 U8_N39084 PNP8 {x14}
R_U8_R18         U8_N01099 U8_N82756  125
Q_U8_Q49         U8_N78893 U8_N78893 U8_N80276 NPN8 {x5}
E_U8_E2         U8_N389559 -VCC +VCC -VCC 0.5
R_U8_R24         U8_N163888 FB  0.01
R_U8_R23         VREF U8_N52536  10
R_U8_R10         U8_N23775 U8_N13605  600
Q_U8_Q47         U8_N75689 U8_N78893 U8_N73458 NPN8 {x3}
R_U8_R13         U8_N00843 U8_N13605  250
X_U8_F1    U8_N389453 U8_N389559 VREF U8_N389559 VCA821_4_OUTPUT_STAGE_U8_F1
Q_U8_Q45         U8_N63102 N10100 U8_N66552 NPN8 {x2}
C_U8_C7         U8_N00839 U8_N13605  0.85p  TC=0,0
Q_U8_Q39         U8_N13605 U8_N38844 U8_N84507 NPN8 {x14}
Q_U8_Q52         OUT U8_N91269 -VCC NPN8 {x60}
Q_U8_Q36         U8_N39084 U8_N31052 U8_N32378 PNP8 {x6}
R_U8_R16         U8_N01099 U8_N80276  150
Q_U8_Q43         U8_N75689 U8_N63102 U8_N163888 PNP8 {x8}
R_U8_R21         +VCC U8_N13605  20
Q_U8_Q50         U8_N84507 U8_N78893 U8_N82756 NPN8 {x6}
C_U8_C8         U8_N01099 U8_N80276  0.85p  TC=0,0
Q_U8_Q33         U8_N01025 N09821 U8_N24027 PNP8 {x2}
Q_U8_Q41         U8_N35588 U8_N01025 U8_N163888 NPN8 {x8}
R_U8_R11         U8_N01099 U8_N67452  600
D_U8_D14         U8_N73458 U8_N01099 DX
Q_U8_Q42         U8_N63102 U8_N63102 U8_N52536 PNP8 {x8}
Q_U8_Q35         U8_N31052 U8_N31052 U8_N00839 PNP8 {x5}
Q_U8_Q32         U8_N24027 U8_N24027 U8_N23775 PNP8 {x2}
Q_U8_Q51         U8_N91269 U8_N91269 -VCC NPN8 {x60}
D_U8_D17         U8_N163888 U8_N1399050 DX
Q_U8_Q62         U8_N01099 U8_N38844 U8_N39084 PNP8 {x8}
Q_U8_Q61         U8_N13605 U8_N38844 U8_N84507 NPN8 {x8}
D_U8_U1         U8_N389449 U8_N389559 dn3
Q_U8_Q34         U8_N35588 U8_N31052 U8_N00843 PNP8 {x3}
C_U8_C2         U8_N38844 U8_N13605  0.89p
D_U8_D18         U8_N1399050 U8_N52536 DX
R_U8_R12         U8_N01099 U8_N67680  600
Q_U8_Q59         U8_N114858 U8_N114858 +VCC PNP8 {x60}
D_U8_D16         U8_N1375710 U8_N163888 DX
Q_U8_Q46         U8_N66552 U8_N66552 U8_N67680 NPN8 {x2}
Q_U8_Q44         N10100 U8_N66552 U8_N67452 NPN8 {x2}
Q_U8_Q60         OUT U8_N114858 +VCC PNP8 {x60}
R_U8_R14         U8_N00839 U8_N13605  150
Q_U8_Q58         U8_N114858 U8_N39084 OUT NPN8 {x60}
I_U8_I1         U8_N389559 U8_N389449 DC 3.12u
Q_U8_Q37         U8_N38844 U8_N35588 U8_N31052 PNP8 {x3}
R_U8_R17         U8_N32378 U8_N13605  125
C_U8_C3         U8_N01099 U8_N38844  0.89p
R_U8_R9         U8_N19796 U8_N13605  600
Q_U8_Q48         U8_N38844 U8_N75689 U8_N78893 NPN8 {x3}
R_U8_R19         -VCC U8_N01099  20
D_U8_D12         U8_N13605 U8_N00839 DX
Q_U8_Q31         N09821 U8_N24027 U8_N19796 PNP8 {x2}
D_U8_D13         U8_N52536 U8_N1375710 DX
R_U8_R25         OUT OUT  10
Q_U8_Q53         U8_N91269 U8_N84507 OUT PNP8 {x60}
C_U8_C6         U8_N389449 U8_N389453  10m
D_U8_D11         U8_N13605 U8_N00843 DX
Q_U8_Q40         U8_N01025 U8_N01025 U8_N52536 NPN8 {x8}
R_U8_R15         U8_N01099 U8_N73458  250
D_U8_D15         U8_N80276 U8_N01099 DX
.PARAM  x4={x2*2} x5={x1*5} x12={x6*2} x6={x2*3} x24={x1*24} x8=1 x14={x2*7}
+  x16={x8*2} x18={x1*18} x90={x1*90} x60={x12*5} x1={x2/2} x2={x8/4} x30={x1*30}
+  x3={x1*3}
.MODEL DN3 D( IS=.1F AF=1.0 KF=39.0E-17)
.model dx       d(is=0.1p rs=.1 cjo=2p tt=1p bv=100 ibv=0.1p)
.model NPN8 npn
+ is=7.604e-018
+ bf=157
+ nf=1
+ vaf=78.71
+ ikf=0.03975
+ ise=3.219e-014
+ ne=2
+ br=0.7614
+ nr=1
+ var=1.452
+ ikr=0.08172
+ isc=7.618e-021
+ nc=1.847
+ rb=106
+ irb=0
+ rbm=2.4
+ re=2.52
+ rc=127
+ cje=1.12e-013
+ vje=0.7591
+ mje=0.5406
+ tf=1.213e-011
+ xtf=2.049
+ vtf=1.813
+ itf=0.04293
+ ptf=0
+ cjc=8.208e-015
+ vjc=0.6666
+ mjc=0.4509
+ xcjc=0.0845
+ tr=4e-011
+ cjs=1.16e-013
+ vjs=0.5286
+ mjs=0.4389
+ xtb=1.022
+ eg=1.12
+ xti=1.78
+ kf=3.5e-016
+ af=1
+ fc=0.8273
.model PNP8 pnp
+ is=7.999e-018
+ bf=141.8
+ nf=1
+ vaf=41.58
+ ikf=0.1085
+ ise=2.233e-015
+ ne=1.505
+ br=32.52
+ nr=1.05
+ var=1.093
+ ikr=5e-005
+ isc=6.621e-016
+ nc=1.15
+ rb=62.46
+ irb=0
+ rbm=2.24
+ re=2.537
+ rc=126
+ cje=9.502e-014
+ vje=0.732
+ mje=0.493
+ tf=1.303e-011
+ xtf=35
+ vtf=3.259
+ itf=0.2639
+ ptf=0
+ cjc=1.08e-013
+ vjc=0.7743
+ mjc=0.5
+ xcjc=0.08504
+ tr=1.5e-010
+ cjs=1.29e-013
+ vjs=0.9058
+ mjs=0.4931
+ xtb=1.732
+ eg=1.12
+ xti=2
+ kf=3.5e-016
+ af=1
+ fc=0.85
.ENDS VCA824
.subckt VCA82X_BIAS_U5_F8 1 2 3 4
F_U5_F8         3 4 VF_U5_F8 1
VF_U5_F8         1 2 0V
.ends VCA82X_BIAS_U5_F8
.subckt VCA82X_BIAS_U5_F1 1 2 3 4
F_U5_F1         3 4 VF_U5_F1 1.05
VF_U5_F1         1 2 0V
.ends VCA82X_BIAS_U5_F1
.subckt VCA82X_BIAS_U5_F6 1 2 3 4
F_U5_F6         3 4 VF_U5_F6 1
VF_U5_F6         1 2 0V
.ends VCA82X_BIAS_U5_F6
.subckt VCA82X_BIAS_U5_F3 1 2 3 4
F_U5_F3         3 4 VF_U5_F3 1
VF_U5_F3         1 2 0V
.ends VCA82X_BIAS_U5_F3
.subckt VCA82X_BIAS_U5_F4 1 2 3 4
F_U5_F4         3 4 VF_U5_F4 1
VF_U5_F4         1 2 0V
.ends VCA82X_BIAS_U5_F4
.subckt VCA82X_BIAS_U5_F2 1 2 3 4
F_U5_F2         3 4 VF_U5_F2 1
VF_U5_F2         1 2 0V
.ends VCA82X_BIAS_U5_F2
.subckt VCA82X_BIAS_U5_F5 1 2 3 4
F_U5_F5         3 4 VF_U5_F5 1.05
VF_U5_F5         1 2 0V
.ends VCA82X_BIAS_U5_F5
.subckt VCA82X_INPUT_BUFFER_U6_F1 1 2 3 4
F_U6_F1         3 4 VF_U6_F1 20
VF_U6_F1         1 2 0V
.ends VCA82X_INPUT_BUFFER_U6_F1
.subckt VCA821_4_OUTPUT_STAGE_U8_F1 1 2 3 4
F_U8_F1         3 4 VF_U8_F1 600
VF_U8_F1         1 2 0V
.ends VCA821_4_OUTPUT_STAGE_U8_F1
* TL072 OPERATIONAL AMPLIFIER "MACROMODEL" SUBCIRCUIT
* CREATED USING PARTS RELEASE 4.01 ON 06/16/89 AT 13:08
* (REV N/A)      SUPPLY VOLTAGE: +/-15V
* CONNECTIONS:   NON-INVERTING INPUT
*                | INVERTING INPUT
*                | | POSITIVE POWER SUPPLY
*                | | | NEGATIVE POWER SUPPLY
*                | | | | OUTPUT
*                | | | | |
.SUBCKT TL072    1 2 3 4 5
*
C1   11 12 3.498E-12
C2    6  7 15.00E-12
DC    5 53 DX
DE   54  5 DX
DLP  90 91 DX
DLN  92 90 DX
DP    4  3 DX
EGND 99  0 POLY(2) (3,0) (4,0) 0 .5 .5
FB    7 99 POLY(5) VB VC VE VLP VLN 0 4.715E6 -5E6 5E6 5E6 -5E6
GA    6  0 11 12 282.8E-6
GCM   0  6 10 99 8.942E-9
ISS   3 10 DC 195.0E-6
HLIM 90  0 VLIM 1K
J1   11  2 10 JX
J2   12  1 10 JX
R2    6  9 100.0E3
RD1   4 11 3.536E3
RD2   4 12 3.536E3
RO1   8  5 150
RO2   7 99 150
RP    3  4 2.143E3
RSS  10 99 1.026E6
VB    9  0 DC 0
VC    3 53 DC 2.200
VE   54  4 DC 2.200
VLIM  7  8 DC 0
VLP  91  0 DC 25
VLN   0 92 DC 25
.MODEL DX D(IS=800.0E-18)
.MODEL JX PJF(IS=15.00E-12 BETA=270.1E-6 VTO=-1)
.ENDS
.lib LTC.lib
.lib LTC5.lib
.lib TL072.sub
.backanno
.end
