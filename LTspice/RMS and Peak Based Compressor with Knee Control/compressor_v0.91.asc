Version 4
SHEET 1 8648 5188
WIRE 2720 -1136 2576 -1136
WIRE 2656 -976 2656 -1008
WIRE 2576 -960 2576 -1136
WIRE 2624 -960 2576 -960
WIRE 2720 -944 2720 -1136
WIRE 2720 -944 2688 -944
WIRE 2768 -944 2720 -944
WIRE 2624 -928 2464 -928
WIRE 2656 -848 2656 -912
WIRE 2672 -624 2576 -624
WIRE 2800 -624 2752 -624
WIRE 2832 -624 2800 -624
WIRE 2944 -624 2912 -624
WIRE 2416 -496 2416 -672
WIRE 2880 -464 2880 -496
WIRE 2464 -448 2464 -928
WIRE 2464 -448 2448 -448
WIRE 2496 -448 2464 -448
WIRE 2576 -448 2576 -624
WIRE 2576 -448 2496 -448
WIRE 2800 -448 2800 -624
WIRE 2848 -448 2800 -448
WIRE 2944 -432 2944 -624
WIRE 2944 -432 2912 -432
WIRE 3056 -432 2944 -432
WIRE 2576 -416 2576 -448
WIRE 2848 -416 2800 -416
WIRE 2800 -384 2800 -416
WIRE 6560 -368 6512 -368
WIRE 2880 -336 2880 -400
WIRE 6560 -336 6560 -368
WIRE 2416 -320 2416 -400
WIRE 2576 -320 2576 -352
WIRE 7312 -208 7264 -208
WIRE 7424 -208 7376 -208
WIRE 6560 -192 6560 -256
WIRE 6560 -192 6528 -192
WIRE -3328 -176 -3360 -176
WIRE -2432 -176 -2576 -176
WIRE 5984 -176 5904 -176
WIRE 6320 -176 6048 -176
WIRE 6464 -176 6400 -176
WIRE -1696 -160 -1696 -192
WIRE -1520 -160 -1520 -192
WIRE 6736 -160 6528 -160
WIRE 4688 -144 4544 -144
WIRE 6464 -144 6096 -144
WIRE 6736 -144 6736 -160
WIRE 3424 -128 3376 -128
WIRE 3536 -128 3504 -128
WIRE 3568 -128 3536 -128
WIRE 3680 -128 3648 -128
WIRE 6624 -128 6528 -128
WIRE -3360 -112 -3360 -176
WIRE -2576 -112 -2576 -176
WIRE 544 -112 480 -112
WIRE 864 -112 624 -112
WIRE 6464 -112 6176 -112
WIRE 7264 -112 7264 -208
WIRE 7264 -112 7184 -112
WIRE 7312 -112 7264 -112
WIRE 7424 -112 7424 -208
WIRE 7424 -112 7392 -112
WIRE 7472 -112 7424 -112
WIRE 6624 -96 6528 -96
WIRE 6096 -64 6096 -144
WIRE -1696 -32 -1696 -80
WIRE -1520 -32 -1520 -80
WIRE 208 -32 64 -32
WIRE 480 -32 480 -112
WIRE 544 -32 480 -32
WIRE 720 -32 608 -32
WIRE 1120 -32 1072 -32
WIRE 1232 -32 1200 -32
WIRE -576 -16 -624 -16
WIRE -464 -16 -496 -16
WIRE -432 -16 -464 -16
WIRE -320 -16 -352 -16
WIRE -3360 0 -3360 -32
WIRE 1232 0 1232 -32
WIRE 1264 0 1232 0
WIRE 4624 16 4624 -16
WIRE -2576 32 -2576 -32
WIRE 1776 32 1552 32
WIRE 2000 32 1840 32
WIRE 3600 32 3600 16
WIRE 4544 32 4544 -144
WIRE 4592 32 4544 32
WIRE 6624 32 6624 -96
WIRE 7184 32 7184 -112
WIRE 7184 32 6624 32
WIRE 3536 48 3536 -128
WIRE 3568 48 3536 48
WIRE 4688 48 4688 -144
WIRE 4688 48 4656 48
WIRE 4768 48 4688 48
WIRE 7296 48 7296 0
WIRE 3680 64 3680 -128
WIRE 3680 64 3632 64
WIRE 3776 64 3680 64
WIRE 4384 64 3856 64
WIRE 4512 64 4464 64
WIRE 4592 64 4512 64
WIRE 7184 64 7184 32
WIRE 7264 64 7184 64
WIRE 2720 80 2432 80
WIRE 2864 80 2800 80
WIRE 3088 80 2864 80
WIRE 3136 80 3088 80
WIRE 3360 80 3136 80
WIRE 3488 80 3360 80
WIRE 3568 80 3488 80
WIRE 7472 80 7472 -112
WIRE 7472 80 7328 80
WIRE 7600 80 7472 80
WIRE 7632 80 7600 80
WIRE 7264 96 7136 96
WIRE 3088 112 3088 80
WIRE 3360 112 3360 80
WIRE 4512 112 4512 64
WIRE 7136 112 7136 96
WIRE -3328 128 -3360 128
WIRE 144 128 144 96
WIRE 7600 128 7600 80
WIRE -384 144 -384 112
WIRE 64 144 64 -32
WIRE 112 144 64 144
WIRE 592 144 592 112
WIRE 1152 144 1152 112
WIRE 4624 144 4624 80
WIRE -1696 160 -1696 112
WIRE -1536 160 -1536 112
WIRE -464 160 -464 -16
WIRE -416 160 -464 160
WIRE 208 160 208 -32
WIRE 208 160 176 160
WIRE 304 160 208 160
WIRE 336 160 304 160
WIRE 480 160 480 -32
WIRE 480 160 416 160
WIRE 560 160 480 160
WIRE 1072 160 1072 -32
WIRE 1120 160 1072 160
WIRE 3600 160 3600 96
WIRE -320 176 -320 -16
WIRE -320 176 -352 176
WIRE 112 176 -320 176
WIRE 720 176 720 -32
WIRE 720 176 624 176
WIRE 768 176 720 176
WIRE 864 176 864 -112
WIRE 864 176 832 176
WIRE 912 176 864 176
WIRE 1072 176 1072 160
WIRE 1072 176 992 176
WIRE 1232 176 1232 0
WIRE 1232 176 1184 176
WIRE 1776 176 1776 144
WIRE -3360 192 -3360 128
WIRE -736 192 -944 192
WIRE -656 192 -736 192
WIRE -544 192 -592 192
WIRE -512 192 -544 192
WIRE -416 192 -512 192
WIRE 560 192 544 192
WIRE 1120 192 1104 192
WIRE 1232 192 1232 176
WIRE 1408 192 1232 192
WIRE 1552 192 1552 32
WIRE 1552 192 1488 192
WIRE 1744 192 1552 192
WIRE 2608 192 2512 192
WIRE 2736 192 2672 192
WIRE 2976 192 2976 160
WIRE 3248 192 3248 160
WIRE 7296 192 7296 112
WIRE 2000 208 2000 32
WIRE 2000 208 1808 208
WIRE 2256 208 2000 208
WIRE 2320 208 2256 208
WIRE 2864 208 2864 80
WIRE 2944 208 2864 208
WIRE 3136 208 3136 80
WIRE 3216 208 3136 208
WIRE 4512 208 4512 176
WIRE -2544 224 -2576 224
WIRE -512 224 -512 192
WIRE 544 224 544 192
WIRE 1104 224 1104 192
WIRE 1744 224 1728 224
WIRE 3088 224 3088 176
WIRE 3088 224 3008 224
WIRE 3360 224 3360 176
WIRE 3360 224 3280 224
WIRE 7136 224 7136 192
WIRE -944 240 -944 192
WIRE 2944 240 2864 240
WIRE 3216 240 3136 240
WIRE 3488 240 3488 80
WIRE 3728 240 3488 240
WIRE 144 256 144 192
WIRE 1728 256 1728 224
WIRE 6176 256 6176 -112
WIRE 6176 256 5984 256
WIRE 7600 256 7600 208
WIRE -1696 272 -1696 240
WIRE -1536 272 -1536 240
WIRE -384 272 -384 208
WIRE 592 272 592 208
WIRE 1152 272 1152 208
WIRE 2864 272 2864 240
WIRE -2576 288 -2576 224
WIRE 4432 288 4288 288
WIRE 4784 288 4640 288
WIRE -3360 304 -3360 272
WIRE 1776 304 1776 240
WIRE 2976 304 2976 256
WIRE 3136 304 3136 240
WIRE 3248 304 3248 256
WIRE 3424 304 3376 304
WIRE 3536 304 3504 304
WIRE 3568 304 3536 304
WIRE 3696 304 3648 304
WIRE 2256 320 2256 208
WIRE 2400 320 2256 320
WIRE 2512 320 2512 192
WIRE 2512 320 2480 320
WIRE 2592 320 2512 320
WIRE 2736 320 2736 192
WIRE 2736 320 2672 320
WIRE -512 336 -512 304
WIRE -944 384 -944 320
WIRE 304 384 304 160
WIRE 544 384 304 384
WIRE 1072 384 1072 176
WIRE 1072 384 624 384
WIRE -3232 400 -3360 400
WIRE -2576 400 -2576 368
WIRE -1696 416 -1696 384
WIRE 3120 416 3088 416
WIRE -1520 432 -1520 384
WIRE 3280 432 3216 432
WIRE -2368 448 -2576 448
WIRE 4368 448 4368 416
WIRE 4720 448 4720 416
WIRE 3616 464 3616 448
WIRE 4288 464 4288 288
WIRE 4336 464 4288 464
WIRE 4640 464 4640 288
WIRE 4688 464 4640 464
WIRE -3360 480 -3360 400
WIRE 2624 480 2624 448
WIRE 3536 480 3536 304
WIRE 3584 480 3536 480
WIRE 4432 480 4432 288
WIRE 4432 480 4400 480
WIRE 4784 480 4784 288
WIRE 4784 480 4752 480
WIRE 4832 480 4784 480
WIRE 4880 480 4832 480
WIRE 5024 480 4960 480
WIRE 5056 480 5024 480
WIRE 5168 480 5136 480
WIRE 5392 480 5168 480
WIRE 5504 480 5472 480
WIRE 5536 480 5504 480
WIRE 5648 480 5616 480
WIRE 5760 480 5648 480
WIRE -2576 496 -2576 448
WIRE 2512 496 2512 320
WIRE 2592 496 2512 496
WIRE 3696 496 3696 304
WIRE 3696 496 3648 496
WIRE 3728 496 3696 496
WIRE 3904 496 3808 496
WIRE 4160 496 3968 496
WIRE 4288 496 4160 496
WIRE 4336 496 4288 496
WIRE 4432 496 4432 480
WIRE 4480 496 4432 496
WIRE 4608 496 4560 496
WIRE 4688 496 4608 496
WIRE 2736 512 2736 320
WIRE 2736 512 2656 512
WIRE 3120 512 3120 416
WIRE 3184 512 3120 512
WIRE 3216 512 3216 432
WIRE 3216 512 3184 512
WIRE 3408 512 3216 512
WIRE 3584 512 3408 512
WIRE 2592 528 2512 528
WIRE 4160 528 4160 496
WIRE -1696 544 -1696 496
WIRE -1520 544 -1520 512
WIRE 3408 544 3408 512
WIRE 4288 544 4288 496
WIRE 4608 544 4608 496
WIRE 1344 576 1200 576
WIRE 4368 576 4368 512
WIRE 4720 576 4720 512
WIRE -3360 592 -3360 560
WIRE 3616 592 3616 528
WIRE 1040 608 1040 560
WIRE 1728 608 1520 608
WIRE 1888 608 1792 608
WIRE 2624 608 2624 544
WIRE 5584 608 5584 592
WIRE 3296 624 3296 592
WIRE 5504 624 5504 480
WIRE 5552 624 5504 624
WIRE -2576 640 -2576 576
WIRE 2400 640 2368 640
WIRE 2512 640 2512 528
WIRE 2512 640 2480 640
WIRE 3184 640 3184 512
WIRE 3264 640 3184 640
WIRE 4160 640 4160 608
WIRE 4288 640 4288 608
WIRE 4608 640 4608 608
WIRE 4832 640 4832 480
WIRE 4848 640 4832 640
WIRE 5104 640 5104 608
WIRE 5648 640 5648 480
WIRE 5648 640 5616 640
WIRE 2736 656 2736 512
WIRE 2784 656 2736 656
WIRE 3408 656 3408 608
WIRE 3408 656 3328 656
WIRE 5024 656 5024 480
WIRE 5072 656 5024 656
WIRE 5552 656 5504 656
WIRE 2512 672 2512 640
WIRE 2640 672 2512 672
WIRE 3264 672 3184 672
WIRE 5168 672 5168 480
WIRE 5168 672 5136 672
WIRE 5264 672 5168 672
WIRE 5072 688 5024 688
WIRE 5504 688 5504 656
WIRE 2512 704 2512 672
WIRE 2640 704 2640 672
WIRE 3184 704 3184 672
WIRE 5024 720 5024 688
WIRE -4000 736 -4032 736
WIRE -3344 736 -3376 736
WIRE 1040 736 1040 688
WIRE 1280 736 1280 704
WIRE 3296 736 3296 688
WIRE 5584 736 5584 672
WIRE 1200 752 1200 576
WIRE 1248 752 1200 752
WIRE 1760 752 1760 720
WIRE 1344 768 1344 576
WIRE 1344 768 1312 768
WIRE 1392 768 1344 768
WIRE 1520 768 1520 608
WIRE 1520 768 1472 768
WIRE 1728 768 1520 768
WIRE 5104 768 5104 704
WIRE 1104 784 1072 784
WIRE 1168 784 1104 784
WIRE 1248 784 1168 784
WIRE 1888 784 1888 608
WIRE 1888 784 1792 784
WIRE 2240 784 1888 784
WIRE -4032 800 -4032 736
WIRE -3376 800 -3376 736
WIRE 1728 800 1712 800
WIRE 2512 800 2512 784
WIRE 2640 800 2640 768
WIRE 2640 800 2512 800
WIRE 2512 816 2512 800
WIRE 1168 832 1168 784
WIRE 1712 832 1712 800
WIRE 1280 864 1280 800
WIRE 1760 880 1760 816
WIRE 2656 880 2608 880
WIRE 2768 880 2736 880
WIRE 2848 880 2768 880
WIRE 2992 880 2928 880
WIRE -4032 912 -4032 880
WIRE -3376 912 -3376 880
WIRE 1040 912 1040 832
WIRE 1168 944 1168 896
WIRE 2880 1040 2880 1008
WIRE 2768 1056 2768 880
WIRE 2848 1056 2768 1056
WIRE 2992 1072 2992 880
WIRE 2992 1072 2912 1072
WIRE 3104 1072 2992 1072
WIRE 2848 1088 2768 1088
WIRE 2880 1168 2880 1104
WIRE 2656 1200 2240 1200
WIRE 2768 1200 2768 1088
WIRE 2768 1200 2736 1200
WIRE 2592 1280 2368 1280
WIRE 2768 1280 2768 1200
WIRE 2768 1280 2672 1280
WIRE 5488 1488 5440 1488
WIRE 5600 1488 5568 1488
WIRE 5680 1488 5600 1488
WIRE 5824 1488 5760 1488
WIRE 5712 1648 5712 1616
WIRE 5600 1664 5600 1488
WIRE 5680 1664 5600 1664
WIRE 5824 1680 5824 1488
WIRE 5824 1680 5744 1680
WIRE 6064 1680 5824 1680
WIRE 6176 1680 6144 1680
WIRE 6208 1680 6176 1680
WIRE 6320 1680 6288 1680
WIRE 6416 1680 6320 1680
WIRE 5680 1696 5600 1696
WIRE 1984 1728 1872 1728
WIRE 5712 1776 5712 1712
WIRE 5488 1808 5088 1808
WIRE 5600 1808 5600 1696
WIRE 5600 1808 5568 1808
WIRE 6256 1808 6256 1792
WIRE 6176 1824 6176 1680
WIRE 6224 1824 6176 1824
WIRE 6320 1840 6320 1680
WIRE 6320 1840 6288 1840
WIRE 1936 1856 1936 1840
WIRE 2768 1856 2288 1856
WIRE 2928 1856 2768 1856
WIRE 6224 1856 6176 1856
WIRE 2096 1872 2096 1776
WIRE 2128 1872 2096 1872
WIRE 2320 1888 2320 1776
WIRE 2320 1888 2288 1888
WIRE 5424 1888 5200 1888
WIRE 5600 1888 5600 1808
WIRE 5600 1888 5504 1888
WIRE 6176 1888 6176 1856
WIRE 336 1904 256 1904
WIRE 1984 1904 1984 1728
WIRE 2128 1904 1984 1904
WIRE 2320 1920 2288 1920
WIRE 2528 1920 2400 1920
WIRE 2768 1920 2768 1856
WIRE 2928 1920 2928 1856
WIRE 1120 1936 1072 1936
WIRE 1232 1936 1200 1936
WIRE 1312 1936 1232 1936
WIRE 1456 1936 1392 1936
WIRE 1520 1936 1456 1936
WIRE 1760 1936 1520 1936
WIRE 2128 1936 1760 1936
WIRE 6256 1936 6256 1872
WIRE 2528 1952 2288 1952
WIRE 2592 1952 2528 1952
WIRE 1968 1968 1920 1968
WIRE 2128 1968 2048 1968
WIRE 672 1984 624 1984
WIRE 800 1984 736 1984
WIRE 2368 1984 2288 1984
WIRE 3024 1984 3024 1936
WIRE 4576 1984 4464 1984
WIRE 336 2000 336 1984
WIRE 1920 2000 1920 1968
WIRE 2128 2000 1920 2000
WIRE 2320 2016 2288 2016
WIRE 2400 2016 2320 2016
WIRE 2528 2016 2528 1952
WIRE 2528 2016 2480 2016
WIRE 1760 2032 1760 1936
WIRE 2768 2032 2768 2000
WIRE 2928 2032 2928 2000
WIRE 2992 2032 2928 2032
WIRE 624 2080 624 1984
WIRE 656 2080 624 2080
WIRE 800 2080 800 1984
WIRE 800 2080 736 2080
WIRE 2368 2080 2368 1984
WIRE 2928 2080 2928 2032
WIRE 256 2096 256 1904
WIRE 256 2096 176 2096
WIRE 384 2096 256 2096
WIRE 1344 2096 1344 2064
WIRE 1232 2112 1232 1936
WIRE 1312 2112 1232 2112
WIRE 3024 2112 3024 2080
WIRE 4528 2112 4528 2096
WIRE 5536 2112 4880 2112
WIRE 5696 2112 5536 2112
WIRE 1456 2128 1456 1936
WIRE 1456 2128 1376 2128
WIRE 2320 2128 2320 2016
WIRE 4688 2128 4688 2032
WIRE 4720 2128 4688 2128
WIRE 1312 2144 1232 2144
WIRE 4912 2144 4912 2032
WIRE 4912 2144 4880 2144
WIRE 176 2160 176 2096
WIRE 384 2160 384 2096
WIRE 1760 2160 1760 2112
WIRE 4576 2160 4576 1984
WIRE 4720 2160 4576 2160
WIRE 2928 2176 2928 2144
WIRE 4912 2176 4880 2176
WIRE 5120 2176 4992 2176
WIRE 5536 2176 5536 2112
WIRE 5696 2176 5696 2112
WIRE 4288 2192 4240 2192
WIRE 4720 2192 4288 2192
WIRE -144 2208 -192 2208
WIRE -16 2208 -64 2208
WIRE 2208 2208 2208 2176
WIRE 5120 2208 4880 2208
WIRE 5200 2208 5200 1888
WIRE 5200 2208 5120 2208
WIRE 5264 2208 5200 2208
WIRE 704 2224 704 2192
WIRE 1344 2224 1344 2160
WIRE 4560 2224 4512 2224
WIRE 4720 2224 4640 2224
WIRE 624 2240 624 2080
WIRE 672 2240 624 2240
WIRE 4960 2240 4880 2240
WIRE 5840 2240 5840 2192
WIRE 176 2256 176 2240
WIRE 416 2256 176 2256
WIRE 624 2256 624 2240
WIRE 624 2256 496 2256
WIRE 800 2256 800 2080
WIRE 800 2256 736 2256
WIRE 880 2256 800 2256
WIRE 1120 2256 880 2256
WIRE 1232 2256 1232 2144
WIRE 1232 2256 1200 2256
WIRE 2320 2256 2320 2208
WIRE 2320 2256 2240 2256
WIRE 4512 2256 4512 2224
WIRE 4720 2256 4512 2256
WIRE 672 2272 640 2272
WIRE 4912 2272 4880 2272
WIRE 4992 2272 4912 2272
WIRE 5120 2272 5120 2208
WIRE 5120 2272 5072 2272
WIRE 2320 2288 2320 2256
WIRE 4288 2288 4288 2192
WIRE 5536 2288 5536 2256
WIRE 5696 2288 5696 2256
WIRE 5808 2288 5696 2288
WIRE 384 2304 384 2240
WIRE 496 2304 384 2304
WIRE 640 2304 640 2272
WIRE 640 2304 576 2304
WIRE 176 2336 176 2256
WIRE 384 2336 384 2304
WIRE 1056 2336 1024 2336
WIRE 1232 2336 1232 2256
WIRE 1232 2336 1136 2336
WIRE 4960 2336 4960 2240
WIRE 5696 2336 5696 2288
WIRE -112 2352 -112 2320
WIRE 704 2352 704 2288
WIRE 2208 2352 2208 2304
WIRE -352 2368 -432 2368
WIRE -192 2368 -192 2208
WIRE -192 2368 -272 2368
WIRE -144 2368 -192 2368
WIRE 5840 2368 5840 2336
WIRE -16 2384 -16 2208
WIRE -16 2384 -80 2384
WIRE 112 2384 -16 2384
WIRE 480 2384 448 2384
WIRE 544 2384 480 2384
WIRE 640 2384 640 2304
WIRE 640 2384 624 2384
WIRE 2320 2384 2320 2352
WIRE 4912 2384 4912 2272
WIRE -144 2400 -224 2400
WIRE 4288 2416 4288 2368
WIRE 272 2432 176 2432
WIRE 384 2432 272 2432
WIRE 480 2432 480 2384
WIRE 640 2432 640 2384
WIRE 5696 2432 5696 2400
WIRE 4800 2464 4800 2432
WIRE -112 2480 -112 2416
WIRE -224 2496 -224 2400
WIRE 272 2496 272 2432
WIRE 4912 2512 4912 2464
WIRE 4912 2512 4832 2512
WIRE 640 2528 640 2496
WIRE 4912 2544 4912 2512
WIRE 4800 2608 4800 2560
WIRE 272 2640 272 2576
WIRE 4912 2640 4912 2608
WIRE 3008 2976 2864 2976
WIRE 1824 2992 1776 2992
WIRE 1952 2992 1904 2992
WIRE 2736 3024 2176 3024
WIRE 3200 3024 3136 3024
WIRE 3328 3024 3280 3024
WIRE 3376 3024 3328 3024
WIRE 3504 3024 3456 3024
WIRE 1856 3136 1856 3104
WIRE 2944 3136 2944 3104
WIRE 1584 3152 1488 3152
WIRE 1776 3152 1776 2992
WIRE 1776 3152 1664 3152
WIRE 1824 3152 1776 3152
WIRE 2448 3152 2448 3136
WIRE 2864 3152 2864 2976
WIRE 2912 3152 2864 3152
WIRE 1952 3168 1952 2992
WIRE 1952 3168 1888 3168
WIRE 2000 3168 1952 3168
WIRE 2064 3168 2000 3168
WIRE 2176 3168 2176 3024
WIRE 2176 3168 2128 3168
WIRE 2240 3168 2176 3168
WIRE 2416 3168 2320 3168
WIRE 3008 3168 3008 2976
WIRE 3008 3168 2976 3168
WIRE 3056 3168 3008 3168
WIRE 3408 3168 3408 3136
WIRE 3504 3168 3504 3024
WIRE 3584 3168 3504 3168
WIRE 1824 3184 1744 3184
WIRE 2624 3184 2480 3184
WIRE 2736 3184 2736 3024
WIRE 2736 3184 2688 3184
WIRE 2800 3184 2736 3184
WIRE 2912 3184 2800 3184
WIRE 3056 3184 3056 3168
WIRE 3136 3184 3136 3024
WIRE 3136 3184 3056 3184
WIRE 3328 3184 3328 3024
WIRE 3376 3184 3328 3184
WIRE 2416 3200 2368 3200
WIRE 3504 3200 3504 3168
WIRE 3504 3200 3440 3200
WIRE 3376 3216 3328 3216
WIRE 1856 3264 1856 3200
WIRE 2944 3264 2944 3200
WIRE 3328 3264 3328 3216
WIRE 1744 3280 1744 3184
WIRE 2448 3280 2448 3216
WIRE 3408 3296 3408 3232
WIRE 4784 3296 4640 3296
WIRE 1632 3344 1488 3344
WIRE 1104 3376 1104 3328
WIRE 2112 3376 2064 3376
WIRE 2240 3376 2192 3376
WIRE 2368 3408 2368 3200
WIRE 4720 3424 4720 3392
WIRE 4640 3440 4640 3296
WIRE 4688 3440 4640 3440
WIRE 4784 3456 4784 3296
WIRE 4784 3456 4752 3456
WIRE 4848 3456 4784 3456
WIRE 4112 3472 3984 3472
WIRE 4368 3472 4192 3472
WIRE 4592 3472 4368 3472
WIRE 4688 3472 4592 3472
WIRE 1104 3504 1104 3456
WIRE 1568 3504 1568 3472
WIRE 4592 3504 4592 3472
WIRE 1488 3520 1488 3344
WIRE 1536 3520 1488 3520
WIRE 2144 3520 2144 3488
WIRE 1632 3536 1632 3344
WIRE 1632 3536 1600 3536
WIRE 1792 3536 1632 3536
WIRE 1840 3536 1792 3536
WIRE 1904 3536 1840 3536
WIRE 2064 3536 2064 3376
WIRE 2064 3536 1984 3536
WIRE 2112 3536 2064 3536
WIRE 1328 3552 1136 3552
WIRE 1408 3552 1328 3552
WIRE 1536 3552 1408 3552
WIRE 2240 3552 2240 3376
WIRE 2240 3552 2176 3552
WIRE 2368 3552 2368 3408
WIRE 2368 3552 2240 3552
WIRE 4720 3552 4720 3488
WIRE 2112 3568 2032 3568
WIRE 1408 3584 1408 3552
WIRE 4480 3584 4480 3552
WIRE 4368 3600 4368 3472
WIRE 4448 3600 4368 3600
WIRE 2656 3616 2608 3616
WIRE 2784 3616 2736 3616
WIRE 4592 3616 4592 3568
WIRE 4592 3616 4512 3616
WIRE 1568 3632 1568 3568
WIRE 4448 3632 4368 3632
WIRE 2144 3648 2144 3584
WIRE 2032 3664 2032 3568
WIRE 1104 3680 1104 3600
WIRE 1408 3680 1408 3648
WIRE 4368 3696 4368 3632
WIRE 4480 3696 4480 3648
WIRE 2688 3760 2688 3728
WIRE 1792 3776 1792 3536
WIRE 2448 3776 1792 3776
WIRE 2608 3776 2608 3616
WIRE 2608 3776 2528 3776
WIRE 2656 3776 2608 3776
WIRE 2784 3792 2784 3616
WIRE 2784 3792 2720 3792
WIRE 2848 3792 2784 3792
WIRE 2656 3808 2576 3808
WIRE 2688 3888 2688 3824
WIRE 2576 3904 2576 3808
FLAG -2576 400 0
FLAG -1696 -32 0
FLAG -1520 -32 0
FLAG -624 -16 0
FLAG -2544 224 wav_in
IOPIN -2544 224 Out
FLAG -1696 -192 +15V
FLAG -1520 -192 -15V
FLAG -384 112 +15V
FLAG -384 272 -15V
FLAG -944 384 0
FLAG -3360 304 0
FLAG -3328 128 1V
IOPIN -3328 128 Out
FLAG 544 224 0
FLAG 1104 224 0
FLAG 1264 0 full_rect
IOPIN 1264 0 Out
FLAG 592 112 +15V
FLAG 592 272 -15V
FLAG 1152 112 +15V
FLAG 1152 272 -15V
FLAG 2320 208 full_rect_log
IOPIN 2320 208 Out
FLAG 1728 256 0
FLAG 1776 144 +15V
FLAG 1776 304 -15V
FLAG -3360 0 0
FLAG -3328 -176 1Vramp
IOPIN -3328 -176 Out
FLAG 144 96 +15V
FLAG 144 256 -15V
FLAG 1712 832 0
FLAG 1760 720 +15V
FLAG 1760 880 -15V
FLAG 1040 912 0
FLAG 1040 560 +15V
FLAG 336 2000 0
FLAG 272 2640 0
FLAG 480 2432 0
FLAG 880 2256 tanh_out
IOPIN 880 2256 Out
FLAG 2512 816 0
FLAG 2624 448 +15V
FLAG 2624 608 -15V
FLAG 2784 656 full_rect_log_min_thr
IOPIN 2784 656 Out
FLAG 704 2192 +15V
FLAG 704 2352 -15V
FLAG 2368 640 thr_log
IOPIN 2368 640 In
FLAG 1280 704 +15V
FLAG 1280 864 -15V
FLAG 4288 640 0
FLAG 4848 640 peak_AR
IOPIN 4848 640 Out
FLAG 5264 672 gain_before_ratio
IOPIN 5264 672 Out
FLAG 5104 608 +15V
FLAG 5104 768 -15V
FLAG 2240 784 thr_log
IOPIN 2240 784 Out
FLAG 5760 480 gain_before_ratio_inv
IOPIN 5760 480 Out
FLAG -2576 32 0
FLAG -2432 -176 1Vmod
IOPIN -2432 -176 Out
FLAG 4960 2336 0
FLAG 4240 2192 gain_before_ratio_inv
IOPIN 4240 2192 In
FLAG 5120 2176 0
FLAG 5264 2208 gain_after_ratio
IOPIN 5264 2208 Out
FLAG 5696 2432 0
FLAG 4912 2640 0
FLAG 4688 2032 +5V
FLAG 4912 2032 -5V
FLAG -1696 272 0
FLAG -1536 272 0
FLAG -1696 112 +5V
FLAG -1536 112 -5V
FLAG 5584 592 +15V
FLAG 5584 736 -15V
FLAG 5088 1808 gain_before_ratio
IOPIN 5088 1808 In
FLAG 5504 688 0
FLAG 5712 1616 +15V
FLAG 5712 1776 -15V
FLAG 5440 1488 0
FLAG 5904 -176 signal_in
IOPIN 5904 -176 In
FLAG 7632 80 final
IOPIN 7632 80 Out
FLAG 7600 256 0
FLAG 7136 224 0
FLAG 6736 -144 0
FLAG 5984 256 gain_final
IOPIN 5984 256 In
FLAG 6096 -64 0
FLAG 6416 1680 gain_final
IOPIN 6416 1680 Out
FLAG -736 192 signal_in
IOPIN -736 192 Out
FLAG 2000 3168 tanh_out_gain_inv
IOPIN 2000 3168 Out
FLAG -112 2320 +15V
FLAG -112 2480 -15V
FLAG -224 2496 0
FLAG 2448 3136 +15V
FLAG 2448 3280 -15V
FLAG 2800 3184 tanh_out_clamp
IOPIN 2800 3184 Out
FLAG 1840 3536 vratio_buf
IOPIN 1840 3536 Out
FLAG 3584 3168 tanh_out_clamp2
IOPIN 3584 3168 Out
FLAG 2144 3488 +15V
FLAG 2144 3648 -15V
FLAG 2032 3664 0
FLAG 2944 3104 +15V
FLAG 2944 3264 -15V
FLAG 4464 1984 tanh_out_clamp2_clip_buf
IOPIN 4464 1984 In
FLAG -432 2368 peak_AR_buf_tanh
IOPIN -432 2368 In
FLAG -3360 592 0
FLAG -3232 400 gain_reduction
IOPIN -3232 400 Out
FLAG -2576 640 0
FLAG -2368 448 final_norm
IOPIN -2368 448 Out
FLAG 1104 3680 0
FLAG 1104 3328 -15V
FLAG 1104 784 lin_thr
IOPIN 1104 784 Out
FLAG 1568 3472 +15V
FLAG 1568 3632 -15V
FLAG 1328 3552 vratio
IOPIN 1328 3552 Out
FLAG 2368 3408 vratio_buf_inv
IOPIN 2368 3408 Out
FLAG 4528 2112 0
FLAG 5536 2288 0
FLAG -3376 912 0
FLAG -3344 736 1Vsquare
IOPIN -3344 736 Out
FLAG 3296 592 +15V
FLAG 3296 736 -15V
FLAG 4768 48 peak_AR_buf_tanh
IOPIN 4768 48 Out
FLAG 5024 720 0
FLAG 3376 304 0
FLAG 3376 -128 0
FLAG 3984 3472 tanh_out_clamp2
IOPIN 3984 3472 In
FLAG 4480 3552 +15V
FLAG 4480 3696 -15V
FLAG 4848 3456 tanh_out_clamp2_clip_buf
IOPIN 4848 3456 Out
FLAG 4720 3392 +15V
FLAG 4720 3552 -15V
FLAG 1856 3104 +15V
FLAG 1856 3264 -15V
FLAG 1744 3280 0
FLAG 3408 3136 +15V
FLAG 3408 3296 -15V
FLAG 6256 1792 +15V
FLAG 6256 1936 -15V
FLAG 6176 1888 0
FLAG 3616 448 +15V
FLAG 3616 592 -15V
FLAG 3600 16 +15V
FLAG 3600 160 -15V
FLAG 1168 944 0
FLAG 640 2528 0
FLAG 1408 3680 0
FLAG -512 336 0
FLAG 4288 2416 0
FLAG 4800 2432 +5V
FLAG 4800 2608 -5V
FLAG 5840 2368 +5V
FLAG 5840 2192 -5V
FLAG -544 192 signal_in_ac
IOPIN -544 192 Out
FLAG 2368 2080 0
FLAG 2528 1920 0
FLAG 2592 1952 tanh_norm
IOPIN 2592 1952 Out
FLAG 2928 2176 0
FLAG 2320 2384 0
FLAG 2096 1776 +5V
FLAG 2320 1776 -5V
FLAG 1936 1856 0
FLAG 2768 2032 0
FLAG 1760 2160 0
FLAG 2208 2176 +5V
FLAG 2208 2352 -5V
FLAG 3024 2112 +5V
FLAG 3024 1936 -5V
FLAG 1872 1728 vratio_buf_sym
IOPIN 1872 1728 In
FLAG 1488 3152 tanh_norm
IOPIN 1488 3152 In
FLAG -1520 544 0
FLAG -1520 384 -0.5V
FLAG 2688 3728 +15V
FLAG 2688 3888 -15V
FLAG 2576 3904 -0.5V
FLAG 2848 3792 vratio_buf_sym
IOPIN 2848 3792 Out
FLAG 3328 3264 0
FLAG 4368 3696 0
FLAG 1344 2064 +15V
FLAG 1344 2224 -15V
FLAG 1024 2336 -0.5V
IOPIN 1024 2336 In
FLAG 1072 1936 0
FLAG 1520 1936 tanh_out_shift
IOPIN 1520 1936 Out
FLAG 3728 240 full_rect_log_min_thr_clip2
IOPIN 3728 240 Out
FLAG 3248 160 +15V
FLAG 3248 304 -15V
FLAG 2976 160 +15V
FLAG 2976 304 -15V
FLAG -4032 912 0
FLAG -4000 736 1Vpulse
IOPIN -4000 736 Out
FLAG 4720 416 +15V
FLAG 4720 576 -15V
FLAG 3280 432 full_rect_log_min_thr_clip
IOPIN 3280 432 Out
FLAG 3184 704 0
FLAG 6624 -128 +15V
FLAG 6512 -368 -15V
FLAG 2416 -320 0
FLAG 2416 -672 -0.5V
FLAG 2880 -496 +15V
FLAG 2880 -336 -15V
FLAG 2496 -448 vhalf_kw
IOPIN 2496 -448 Out
FLAG 2576 -320 0
FLAG 2800 -384 0
FLAG 3056 -432 vhalf_kw_inv
IOPIN 3056 -432 Out
FLAG 3136 304 vhalf_kw
IOPIN 3136 304 In
FLAG 2864 272 vhalf_kw_inv
IOPIN 2864 272 In
FLAG 2880 1008 +15V
FLAG 2880 1168 -15V
FLAG 2608 880 0
FLAG 2368 1280 vhalf_kw_inv
IOPIN 2368 1280 In
FLAG 3104 1072 full_rect_log_min_thr_min_half_kw
IOPIN 3104 1072 Out
FLAG 7296 0 +15V
FLAG 7296 192 -15V
FLAG 2240 1200 full_rect_log_min_thr
IOPIN 2240 1200 In
FLAG 2432 80 full_rect_log_min_thr
IOPIN 2432 80 In
FLAG 3008 416 full_rect_log_min_thr_min_half_kw
IOPIN 3008 416 In
FLAG 4160 640 0
FLAG 4368 416 +15V
FLAG 4368 576 -15V
FLAG 4608 640 0
FLAG 4624 -16 +15V
FLAG 4624 144 -15V
FLAG 4512 208 0
FLAG -1696 544 0
FLAG -1696 384 4dBu
FLAG 2656 -1008 +15V
FLAG 2656 -848 -15V
FLAG 2768 -944 vhalf_kw_buf
IOPIN 2768 -944 Out
SYMBOL sym\\voltage -2576 272 R0
WINDOW 3 24 44 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value wavefile="drumloop2.wav"
SYMATTR InstName V1
SYMBOL sym\\voltage -1696 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value +15V
SYMBOL sym\\voltage -1520 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value -15V
SYMBOL res -336 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 47.6K
SYMBOL res -480 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10K
SYMBOL AutoGenerated\\TL072 -384 112 R0
SYMATTR InstName U1
SYMBOL bv -944 224 R0
WINDOW 3 -448 119 Left 2
SYMATTR Value V=1.414*0.775*(10**({dBu_level}/20))*V(1V)
SYMATTR InstName B1
SYMBOL sym\\voltage -3360 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value SINE(0 1 {freq})
SYMBOL res 432 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 6.8K
SYMBOL res 640 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 6.8K
SYMBOL diode 608 -48 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 832 160 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL res 640 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 6.8K
SYMBOL res 1008 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 3.4K
SYMBOL res 1216 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 6.8K
SYMBOL res 1504 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 4.2k
SYMBOL AutoGenerated\\TL072 1776 144 R0
SYMATTR InstName U4
SYMBOL sym\\voltage -3360 -128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PULSE(-1 1 0 {1/(2*freq)} {1/(2*freq)} 0 {1/freq})
SYMBOL AutoGenerated\\TL072 144 96 R0
SYMATTR InstName U5
SYMBOL OpAmps\\LTC6244 592 176 R0
SYMATTR InstName U2
SYMBOL OpAmps\\LTC6244 1152 176 R0
SYMATTR InstName U3
SYMBOL res 1488 752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 4.2k
SYMBOL AutoGenerated\\TL072 1760 720 R0
SYMATTR InstName U6
SYMBOL pot 1040 784 R180
SYMATTR InstName U8
SYMATTR Value2 T={threshold}
SYMBOL res 1024 592 R0
SYMATTR InstName R10
SYMATTR Value 5k
SYMBOL res 160 2144 R0
SYMATTR InstName R11
SYMATTR Value 2K
SYMBOL res 368 2144 R0
SYMATTR InstName R12
SYMATTR Value 2K
SYMBOL npn 112 2336 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL npn 448 2336 M0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL sym\\voltage 336 1888 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 5V
SYMBOL current 272 2496 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value 247µA
SYMBOL res 592 2288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 100K
SYMBOL res 640 2368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 100K
SYMBOL res 512 2240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 100K
SYMBOL res 752 2064 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 100K
SYMBOL res 2496 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 10K
SYMBOL res 2496 688 R0
SYMATTR InstName R18
SYMATTR Value 10K
SYMBOL res 2496 624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 10K
SYMBOL res 2688 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 10K
SYMBOL AutoGenerated\\TL072 2624 448 R0
SYMATTR InstName U10
SYMBOL AutoGenerated\\TL072 704 2192 R0
SYMATTR InstName U9
SYMBOL cap 736 1968 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 0.2n
SYMATTR SpiceLine V=25 Rser=0.2
SYMBOL AutoGenerated\\TL072 1280 704 R0
SYMATTR InstName U13
SYMBOL cap 2672 176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 0.3n
SYMATTR SpiceLine V=50 Irms=0 Rser=0.1 Lser=0
SYMBOL cap 4272 544 R0
SYMATTR InstName C5
SYMATTR Value 0.1µ
SYMATTR SpiceLine V=10 Irms=0 Rser=0.003 Lser=0
SYMBOL AutoGenerated\\TL072 5104 608 R0
SYMATTR InstName U15
SYMBOL bv -2576 -128 R0
SYMATTR InstName B2
SYMATTR Value V=V(1V)*sin({modfreq}*2*pi*time)
SYMBOL res 4656 2208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R41
SYMATTR Value 1k
SYMBOL res 5088 2256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R42
SYMATTR Value 1k
SYMBOL res 5008 2160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R43
SYMATTR Value 20
SYMBOL VCA824 4800 2192 R0
SYMATTR InstName U23
SYMBOL res 5712 2160 M0
SYMATTR InstName R46
SYMATTR Value 1k
SYMBOL cap 5712 2336 M0
SYMATTR InstName C1
SYMATTR Value 0.1µ
SYMATTR SpiceLine V=50 Irms=0 Rser=0.09 Lser=0
SYMBOL res 4896 2368 R0
SYMATTR InstName R47
SYMATTR Value 4k
SYMBOL cap 4896 2544 R0
SYMATTR InstName C2
SYMATTR Value 0.1µ
SYMBOL sym\\voltage -1696 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value 5V
SYMBOL sym\\voltage -1536 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value -5V
SYMBOL AutoGenerated\\TL072 5584 576 R0
SYMATTR InstName U24
SYMBOL res 5632 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R50
SYMATTR Value 10k
SYMBOL res 5488 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R51
SYMATTR Value 10k
SYMBOL res 5584 1472 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R52
SYMATTR Value 100k
SYMBOL res 5584 1792 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R53
SYMATTR Value 100k
SYMBOL res 5776 1472 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R54
SYMATTR Value 100k
SYMBOL AutoGenerated\\TL072 5712 1616 R0
SYMATTR InstName U25
SYMBOL res 5520 1872 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R55
SYMATTR Value 100k
SYMBOL res 7408 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R58
SYMATTR Value 20K
SYMBOL cap 7376 -224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 22p
SYMATTR SpiceLine V=50 Irms=0 Rser=0.1601 Lser=520p mfg="Würth Elektronik" pn="885012008039 WCAP-CSGP 1206" type="NP0"
SYMBOL res 6416 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R59
SYMATTR Value 20K
SYMBOL res 7584 112 R0
SYMATTR InstName R60
SYMATTR Value 10Meg
SYMBOL ZZZ\\OpAmp\\TL072 7296 16 R0
SYMATTR InstName U27
SYMBOL sym\\voltage 7136 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V17
SYMATTR Value 0
SYMBOL AutoGenerated\\THAT2180A 6496 -144 R0
SYMATTR InstName U28
SYMBOL res 6544 -352 R0
SYMATTR InstName R61
SYMATTR Value 5.1K
SYMBOL AutoGenerated\\TL072 -112 2320 R0
SYMATTR InstName U22
SYMBOL res -48 2192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R65
SYMATTR Value {tanh_gain_in}
SYMBOL res -256 2352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R66
SYMATTR Value 10k
SYMBOL AutoGenerated\\TL072 2448 3120 R0
SYMATTR InstName U7
SYMBOL res 2336 3152 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 10k
SYMBOL cap 2128 3152 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 10µ
SYMATTR SpiceLine Rser=0.09
SYMBOL diode 2688 3168 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D14
SYMATTR Value 1N4148
SYMBOL AutoGenerated\\TL072 2144 3488 R0
SYMATTR InstName U29
SYMBOL res 2208 3360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R68
SYMATTR Value 10k
SYMBOL res 2000 3520 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R69
SYMATTR Value 10k
SYMBOL AutoGenerated\\TL072 2944 3104 R0
SYMATTR InstName U30
SYMBOL bv -3360 464 R0
SYMATTR InstName B3
SYMATTR Value V=20*log10(abs(V(signal_in))) -20*log10(abs(V(final)))
SYMBOL bv -2576 480 R0
SYMATTR InstName B4
SYMATTR Value V=V(final)/(1.414*0.775*(10**({dBu_level}/20)))
SYMBOL pot 1104 3552 R180
SYMATTR InstName U11
SYMATTR Value2 T= 1/{ratio_ctrl} stiff=10000
SYMATTR Value R=1k
SYMATTR SpiceModel exppot
SYMBOL res 1088 3360 R0
SYMATTR InstName R62
SYMATTR Value 14k
SYMBOL AutoGenerated\\TL072 1568 3472 R0
SYMATTR InstName U31
SYMBOL sym\\voltage 4528 2000 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value 0V
SYMBOL res 5520 2160 R0
SYMATTR InstName R63
SYMATTR Value 100k
SYMBOL sym\\voltage -3376 784 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value PULSE(-1 1 0 1e-6 1e-6 {duty/freq} {1/freq})
SYMBOL diode 3424 608 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D12
SYMATTR Value 1N4148
SYMBOL Opamps\\LTC6244 3296 656 R0
SYMATTR InstName U32
SYMBOL res 3104 400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 1k
SYMBOL res 5152 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R72
SYMATTR Value 308.8
SYMBOL res 4976 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R73
SYMATTR Value 10k
SYMBOL res 3664 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R74
SYMATTR Value 30.808k
SYMBOL res 3520 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R75
SYMATTR Value 1k
SYMBOL res 3664 -144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R76
SYMATTR Value 30.808k
SYMBOL res 3520 -144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R77
SYMATTR Value 1k
SYMBOL diode 4576 3504 R0
SYMATTR InstName D19
SYMATTR Value 1N4148
SYMBOL Opamps\\LTC6244 4480 3616 R0
SYMATTR InstName U36
SYMBOL res 4208 3456 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R78
SYMATTR Value 1k
SYMBOL AutoGenerated\\TL072 4720 3392 R0
SYMATTR InstName U38
SYMBOL AutoGenerated\\TL072 1856 3104 R0
SYMATTR InstName U12
SYMBOL res 1920 2976 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R56
SYMATTR Value 10k
SYMBOL res 1680 3136 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R57
SYMATTR Value 10k
SYMBOL AutoGenerated\\TL072 3408 3136 R0
SYMATTR InstName U18
SYMBOL res 3472 3008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 10k
SYMBOL res 6304 1664 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 35k
SYMBOL res 6160 1664 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R40
SYMATTR Value 10k
SYMBOL OpAmps\\LT1217 6256 1776 R0
SYMATTR InstName U37
SYMBOL res 3824 480 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R67
SYMATTR Value 250
SYMBOL OpAmps\\LT1217 3616 432 R0
SYMATTR InstName U14
SYMBOL OpAmps\\LT1217 3600 0 R0
SYMATTR InstName U33
SYMBOL sym\\voltage -1696 400 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC 1.736
SYMATTR InstName V7
SYMATTR Value ""
SYMBOL cap 2656 768 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C11
SYMATTR Value 0.3n
SYMATTR SpiceLine V=50 Irms=0 Rser=0.1 Lser=0
SYMBOL cap 1152 832 R0
SYMATTR InstName C12
SYMATTR Value 1µ
SYMBOL cap 624 2432 R0
SYMATTR InstName C14
SYMATTR Value 0.2n
SYMATTR SpiceLine V=25 Rser=0.2
SYMBOL cap 1392 3584 R0
SYMATTR InstName C15
SYMATTR Value 1µ
SYMBOL cap 6048 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C16
SYMATTR Value 10µ
SYMBOL cap -592 176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C17
SYMATTR Value 1µ
SYMBOL res -528 208 R0
SYMATTR InstName R80
SYMATTR Value 200k
SYMBOL diode 1728 624 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL diode 1776 48 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D8
SYMATTR Value 1N4148
SYMBOL res 4272 2272 R0
SYMATTR InstName R81
SYMATTR Value 100k
SYMBOL pot 4800 2512 M0
SYMATTR InstName U26
SYMATTR Value2 T=.4917
SYMBOL pot 5840 2288 M180
SYMATTR InstName U39
SYMATTR Value R=1meg
SYMATTR Value2 T=.8029
SYMBOL res 2064 1952 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R48
SYMATTR Value 1k
SYMBOL res 2496 2000 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R49
SYMATTR Value 1k
SYMBOL res 2416 1904 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R82
SYMATTR Value 20
SYMBOL VCA824 2208 1936 R0
SYMATTR InstName U41
SYMBOL res 2944 1904 M0
SYMATTR InstName R83
SYMATTR Value 1k
SYMBOL cap 2944 2080 M0
SYMATTR InstName C18
SYMATTR Value 0.1µ
SYMATTR SpiceLine V=50 Irms=0 Rser=0.09 Lser=0
SYMBOL res 2304 2112 R0
SYMATTR InstName R84
SYMATTR Value 4k
SYMBOL cap 2304 2288 R0
SYMATTR InstName C19
SYMATTR Value 0.1µ
SYMBOL sym\\voltage 1936 1744 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V19
SYMATTR Value 0V
SYMBOL res 2752 1904 R0
SYMATTR InstName R85
SYMATTR Value 100k
SYMBOL res 1744 2016 R0
SYMATTR InstName R86
SYMATTR Value 100k
SYMBOL pot 2208 2256 M0
SYMATTR InstName U42
SYMATTR Value2 T=.4917
SYMBOL pot 3024 2032 M180
SYMATTR InstName U43
SYMATTR Value R=1meg
SYMATTR Value2 T=.8033
SYMBOL res 3296 3008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R87
SYMATTR Value 10k
SYMBOL sym\\voltage -1520 416 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V20
SYMATTR Value -0.5V
SYMBOL AutoGenerated\\TL072 2688 3728 R0
SYMATTR InstName U44
SYMBOL res 2752 3600 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R88
SYMATTR Value 10k
SYMBOL res 2544 3760 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R89
SYMATTR Value 10k
SYMBOL res 1216 1920 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 10K
SYMBOL res 1216 2240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 10K
SYMBOL res 1408 1920 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R44
SYMATTR Value 10K
SYMBOL AutoGenerated\\TL072 1344 2064 R0
SYMATTR InstName U35
SYMBOL res 1152 2320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R45
SYMATTR Value 10K
SYMBOL diode 3376 176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -49 5 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL Opamps\\LTC6244 3248 224 R0
SYMATTR InstName U40
SYMBOL diode 3072 112 R0
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMBOL Opamps\\LTC6244 2976 224 R0
SYMATTR InstName U45
SYMBOL res 2816 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R71
SYMATTR Value 1k
SYMBOL sym\\voltage -4032 784 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value PULSE(0 1 20ms 1e-6 1e-6 0.1 0 1)
SYMBOL AutoGenerated\\TL072 4720 416 R0
SYMATTR InstName U16
SYMBOL schottky 3904 512 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D10
SYMATTR Value RB500SM-30
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL pot 2416 -448 R180
SYMATTR InstName U17
SYMATTR Value2 T={knee}
SYMBOL AutoGenerated\\TL072 2880 -496 R0
SYMATTR InstName U19
SYMBOL cap 2560 -416 R0
SYMATTR InstName C9
SYMATTR Value 1µ
SYMBOL res 2928 -640 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R30
SYMATTR Value 10k
SYMBOL res 2768 -640 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 10k
SYMBOL res 2752 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value 10K
SYMBOL res 2752 1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value 10K
SYMBOL res 2944 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R36
SYMATTR Value 10k
SYMBOL AutoGenerated\\TL072 2880 1008 R0
SYMATTR InstName U21
SYMBOL res 2688 1264 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R37
SYMATTR Value 10K
SYMBOL res 4144 512 R0
SYMATTR InstName R27
SYMATTR Value {release}
SYMBOL AutoGenerated\\TL072 4368 416 R0
SYMATTR InstName U20
SYMBOL res 4576 480 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value {attack}
SYMBOL cap 4592 544 R0
SYMATTR InstName C10
SYMATTR Value 0.1µ
SYMATTR SpiceLine V=10 Irms=0 Rser=0.003 Lser=0
SYMBOL AutoGenerated\\TL072 4624 -16 R0
SYMATTR InstName U46
SYMBOL res 4480 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value {attack}
SYMBOL cap 4496 112 R0
SYMATTR InstName C13
SYMATTR Value 0.1µ
SYMATTR SpiceLine V=10 Irms=0 Rser=0.003 Lser=0
SYMBOL AutoGenerated\\TL072 2656 -1008 R0
SYMATTR InstName U47
SYMBOL res 3872 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R34
SYMATTR Value 250
TEXT -1280 152 Left 2 ;Conversion from 1V max to dBu_level.\nCircuit nominal is 4dBu
TEXT -2568 184 Left 2 ;input wavefile
TEXT -3360 88 Left 2 ;1V reference sine for tests
TEXT 176 -232 Left 5 ;PRECISION FULL WAVE RECTIFIER
TEXT 1552 -40 Left 2 ;linear to log signal converter
TEXT -736 -80 Left 2 ;gain 5.76 so that we get 10V at 4dBU for rectifier stage
TEXT -184 -152 Left 2 ;op amp buffer to make output impedance as low as possible \nas the following rectifier stage is sensitive to it
TEXT 1512 -248 Left 2 ;log stage transfer function Vout=   -Vt*ln(Vin/(Is*R))\nVt = diode thermal voltage, Is = diode saturation current\nthermal voltage depends on absolute temperature, which would go up with room temperature\nand high signal levels (more current flowing in the diodes = more heat)\nthermal management may be advised, ex: both diodes for signal and threshold could be termally\ncoupled.\nAlso advised to match both diodes
TEXT 1528 544 Left 2 ;linear to log threshold converter
TEXT 920 448 Left 5 ;THRESHOLD POT
TEXT 2624 696 Left 2 ;out = full_rect_log - thr_log
TEXT 520 872 Left 2 ;thr_log more negative = higher threshold\nwiper closer to 1 = lower threshold\nwiper closer to 0 = higher threshold
TEXT 3992 -352 Left 5 ;LOG DOMAIN PEAK DETECTOR +  EXP A/R
TEXT 3992 440 Left 2 ;release potentiometer
TEXT 4440 416 Left 2 ;attack potentiometer
TEXT 4376 2376 Left 2 ;input offset compensation
TEXT 4952 2504 Left 2 ;output offset compensation
TEXT -1672 -304 Left 4 ;RAILS
TEXT -2664 616 Left 2 !.wave "drumloop2_compressed2.wav" 16 44.1K V(final_norm)
TEXT -2976 -296 Left 2 !.param modfreq = {10}
TEXT -2976 -264 Left 2 !.param freq = {20}
TEXT 2672 2760 Left 2 ;What we have is a smooth transition between unity gain setpoint (0V), ratio = 1\nand set ratio voltage.
TEXT -2576 -232 Left 2 ;1V amplitude modulated sine for tests
TEXT -3352 -224 Left 2 ;1V triangle
TEXT -3344 352 Left 2 ;gain reduction quick&dirty (zoom to get rid of singularities)
TEXT -2976 -488 Left 2 !.tran 0 0.2 1ms {1/sample_rate} uic
TEXT -2976 -360 Left 2 !.param dBu_level = {4}
TEXT -2976 -328 Left 2 !.param sample_rate = 44.1k
TEXT -2976 -392 Left 2 !.options cshunt=1e-15
TEXT -3432 -480 Left 5 ;TEST BENCH
TEXT -2528 416 Left 2 ;compressor output
TEXT 712 1720 Left 5 ;KNEE MANAGEMENT
TEXT 1960 -8 Left 5 ;SIGNAL(dB) - THRESHOLD(dB) STAGE
TEXT 152 1864 Left 2 ;tanh() cell using a BJT differential pair
TEXT -1352 2552 Left 2 ;tanh() saturation... low R65 looks more like sine. (very soft knee)\n very high R65 introduces high distortion at knee. (folding)
TEXT 1168 3288 Left 5 ;RATIO POT
TEXT 2040 2904 Left 2 ;clamp tanh_out_gain_inv output positive excursions to -vratio level (positive value).\nshould not happen unless tanh() current sink is above 247µA.\nthen,  tanh_out_gain_inv may go above -vratio.
TEXT 3896 1632 Left 2 ;gain = gain_before_ratio*( 1 - 1/ratio)\ngain = gain_before_ratio + gain_before_ratio_inv/ratio  (gain_after_ratio_inv is negative)\ngain = gain_before_ratio + gain_after_ratio (gain_after_ratio is negative)
TEXT 6056 -528 Left 5 ;AUDIO PATH VCA STAGE - FEEDFORWARD
TEXT -2976 -520 Left 2 !;ac dec 10 20 100000
TEXT -3368 688 Left 2 ;1V square
TEXT -2976 -232 Left 2 !.param duty = {0.5}
TEXT 2928 800 Left 2 ;Here 0V level is threshold +kw/2. The point at which the compressor should start working\nwe clip signal under 0V
TEXT 608 728 Left 2 ;lin_v = 15*(1-t)*10k/(10k +5k)
TEXT 1400 384 Left 2 ;the incentive to use a lin to log diode converter instead of a log pot is :\nuse the same transfer function. (make calibration easier)\nhave the thermal effect partially cancel each other (since both diode networks heat more or less\nthe same way, but that is assuming current is the same which is not because the threshold\ndiode  is subject to DC)
TEXT 6048 1008 Left 2 ;The peak detector A/R stage contribution is made negligible by setting the fastest A/R possible,\nR=100 ohms for both\nwe ommit input gain = 5.76 because both vin and vthr use the same gain so it cancels out.\ntechnically we could ommit Is*R because they also cancel out...\n \nn*-Vt*ln(Vin/(Is*R))\n25.4mV*ln(Vin/(2nA*4.2k))\ndeltaVln = 25.4mV*ln(Vin/(2nA*4.2k)) - 25.4mV*ln(Vthr/(2nA*4.2k)) \ndeltaVln = 25.4mV*(ln(Vin/(2nA*4.2k)) - ln(Vthr/(2nA*4.2k)))\ndeltaVln = 25.4mV*(ln(Vin) - ln(Vthr)  -ln(2nA*4.2k) + ln(2nA*4.2k))\n \nnow convert ln2 to log10, hence the factor 2.303 and then to dBV...\n \ndeltaVllog = (25.4mV*2.303)*(log(Vin) - log(Vthr))\ndeltaVllog = (25.4mV*2.303)*(log(Vin) - log(Vthr))\ndbV = 20*log(V)\nwe want k*25.4mV*2.303 = 20\nk =20/(2.303-*25.4mV)\nk = 341.9\nand we also have THAT2180 1 dbV gain = 0.0061V\nthus final normalization gain = 341.9*0.0061 = 2.08559\nk = 2.08559
TEXT 5872 -232 Left 2 ;use good audio cap here
TEXT 5952 328 Left 2 ;gain_final OUTPUT impedance should be as low as possible to drive THAT2180 properly\nZ_out << 50 Ohms.\ncompare that to TL072 125ohms open loop resistance.\nThat's why we use a high current low output impedance LT1217 Op Amp
TEXT 3424 672 Left 2 ;gain_in 1 + R74/R75 (here 30.808/1 +1 = 31.808) so that we renormalize to 10V max
TEXT 2272 584 Left 2 ;max log_min_thr (4dbU triangle signal, threshold -INF dB) =  0.31425V
TEXT 4992 632 Left 2 ;we're back to 0.314V max
TEXT 3640 584 Left 2 ;R67 current limiting resistor to protect U14
TEXT 3616 128 Left 2 ;R79 current limiting resistor to protect U33
TEXT 1512 -360 Left 2 ;THEORY = 25.4mV*ln(Vin*5.76/(2nA*4.2k))\n 25.4mV*ln(10/(2nA*4.2k)) = 0.355325
TEXT 3912 1928 Left 2 ;gain_before ratio has to stay under 1.6V !!! as per VCA824 datasheet
TEXT -2976 -456 Left 2 !;.noise V(final) V7 dec 10 1 20000
TEXT 2312 256 Left 2 ;0.1% or less
TEXT 2536 256 Left 2 ;0.1% or less
TEXT 2320 688 Left 2 ;0.1% or less
TEXT 2336 752 Left 2 ;0.1% or less
TEXT 1448 280 Left 2 ;D8 and D4 must be matched and coupled thermally
TEXT 1784 2120 Left 2 ;input offset compensation
TEXT 2360 2248 Left 2 ;output offset compensation
TEXT -832 2328 Left 2 ;input signal amplitude could be as high as 10V
TEXT 2440 3528 Left 2 ;symmetry point is 0.5V this is an inverting op amp with 0.5V reference symmetry.\nused to properly condition the gain signal of the VCA824 (U41) that performs tanh() normalization
TEXT 3248 2960 Left 2 ;inverting op amp
TEXT 2040 1640 Left 2 ;tanh() normalizer ( so that : vratio_buf < tanh_norm < 0V )\nthis assumes that the previous tanh() cell is well behaved and  -0.5V < tanh_out < 0.5V\nif not, the following clamping stage will take care of unwanted excursions.
TEXT 3592 3328 Left 2 ;a bit of extra precaution so that VG fed to the U23 VCA824 never goes above 0V.\ntanh() normalization and clamping action is not perfect, as well as U41 VCA824 always \nhas some offset despite calibration, so we clip above 0V here.\nclamping is also required if tanh() current source is also set above 247µA
TEXT -232 2144 Left 2 ;tweak 200 < R65 < 1.5k
TEXT 2704 -64 Left 2 !.param bw = {0.05}
TEXT 2848 40 Left 2 ;here we clip signal under -kw/2 and above kw/2 0V is threshold
TEXT 2416 -88 Left 2 ;bw is the threshold bandwidth for soft/hard knee application
TEXT -1352 2432 Left 2 ;setting I1 above 247µA gives a tanh() output that is no more bound from [-0.5V to 0.5V]\nNormalization and shifting to 0.5 is no more sufficient to set final ratio signal inside [vratio, 0V] range. \nhowever, clamping at -vratio and clipping at 0V before the U23 VCA824 make the\ncircuit compensated once again should that happen.
TEXT -4024 688 Left 2 ;1V square pulse
TEXT -4072 664 Left 2 ;for testing A/R constants
TEXT 3720 640 Left 2 ;account for diode drop in final gain.
TEXT 3808 712 Left 2 ;attack range 100 - 10k\nrelease range 10k - 10Meg
TEXT 1192 3344 Left 4 ;RATIO = 1/T\nvratio =  T - 1
TEXT 3600 1584 Left 4 ;GAIN COMPUTER (U23 with variable ratio for knee management and U25 for final gain)
TEXT 6048 952 Left 4 ;FINAL GAIN NORMALIZATION
TEXT 7248 -264 Left 2 ;CURRENT TO VOLTAGE
TEXT 6264 -224 Left 2 ;CURRENT LIMITING
TEXT 2464 -712 Left 5 ;KNEE WIDTH POT
TEXT 2168 -544 Left 4 ;KW = 1 - T
TEXT 2816 1240 Left 2 ;We offset down the selected threshold by half knee width.\nThis to ensure smooth knee application, so that the gain computer and knee width start\nworking at the same levels
TEXT 3624 -256 Left 2 ;decoupling A/R with diodes is one way to do it, but it introduces a diode voltage drop.\nIt is mainly experimental. The more standard way is to use separate attack/release stages\nseparated by a buffer
TEXT 5368 -312 Left 2 ;the sidechain and the audio path branches before the capacitor and each uses different caps\nit may create phase problems. You can try using a single cap.
TEXT 432 1768 Left 2 ;quite experimental. may introduce distortion for small knee widths (hard knee = distortion)\nthis is because of the use of the tanh() function
TEXT -3424 -728 Left 2 !.param knee=0.95
TEXT -3424 -696 Left 2 !.param ratio_ctrl = 25
TEXT -3424 -664 Left 2 !.param threshold = 0.5
TEXT 4304 -32 Left 2 ;LP filter potentiometer
TEXT -3424 -632 Left 2 !.param attack = 100
TEXT -3424 -600 Left 2 !.param release = 100
TEXT -3432 -776 Left 5 ;COMPRESSOR PARAMETERS
TEXT -4088 -728 Left 2 !;.step param knee 0.85 0.98 0.02
TEXT -4088 -688 Left 2 !;.step param ratio_ctrl 1 50 5
TEXT -4088 -600 Left 2 !;.step param attack 0.3 1 0.1
TEXT -4088 -640 Left 2 !;.step dec param tanh_gain_in 100 10000 3
TEXT -3416 -568 Left 2 !.param tanh_gain_in = 4000
TEXT 6352 1744 Left 2 ;35.3456k
TEXT -4232 -504 Left 2 ;ratio_ctrl not the actual ratio
TEXT -4224 -400 Left 2 ;APPROXIMATIVE TABLE :\nratio_ctrl      ratio\n6                 1.31\n11                1.85\n16                2.47\n21                3.22\n26                4.11\n31                5.22\n36                6.25\n41                8.4\n46                10.2\n51                 12.2
TEXT -4088 -560 Left 2 !.step param threshold 0.1 1 0.1
TEXT -2208 -672 Left 2 ;www.skynext.tech
TEXT -2208 -704 Left 5 ;Author : R.Verissimo
TEXT -2200 -600 Left 2 ;release 0.91 05/09/2023
