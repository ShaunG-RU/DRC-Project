Version 4
SHEET 1 4632 3248
WIRE 2160 -384 2160 -416
WIRE 832 -288 832 -320
WIRE 2160 -256 2160 -304
WIRE 2352 -256 2160 -256
WIRE -1232 -224 -1264 -224
WIRE -912 -224 -1152 -224
WIRE 2160 -224 2160 -256
WIRE 2352 -224 2352 -256
WIRE 1120 -208 1072 -208
WIRE 1248 -208 1200 -208
WIRE 1248 -192 1248 -208
WIRE 832 -160 832 -208
WIRE 912 -160 832 -160
WIRE 1072 -160 1072 -208
WIRE 1072 -160 992 -160
WIRE -1264 -128 -1264 -224
WIRE -1184 -128 -1264 -128
WIRE -1056 -128 -1120 -128
WIRE 832 -128 832 -160
WIRE -672 -112 -736 -112
WIRE -512 -112 -592 -112
WIRE 1072 -112 1072 -160
WIRE 1104 -112 1072 -112
WIRE 1248 -112 1248 -128
WIRE 1248 -112 1168 -112
WIRE 2160 -112 2160 -144
WIRE 2352 -80 2352 -144
WIRE 2384 -80 2352 -80
WIRE 2496 -80 2464 -80
WIRE 832 -16 832 -48
WIRE -1440 0 -1472 0
WIRE -1408 0 -1440 0
WIRE -1264 0 -1264 -128
WIRE -1264 0 -1328 0
WIRE -1184 0 -1264 0
WIRE 240 0 240 -16
WIRE 512 0 512 -16
WIRE -1056 16 -1056 -128
WIRE -1056 16 -1120 16
WIRE -1008 16 -1056 16
WIRE -912 16 -912 -224
WIRE -912 16 -944 16
WIRE -864 16 -912 16
WIRE -736 16 -736 -112
WIRE -736 16 -784 16
WIRE -672 16 -736 16
WIRE 1072 16 1072 -112
WIRE 1120 16 1072 16
WIRE 1248 16 1248 -112
WIRE 1248 16 1184 16
WIRE -1184 32 -1216 32
WIRE -512 32 -512 -112
WIRE -512 32 -608 32
WIRE -432 32 -512 32
WIRE -112 32 -144 32
WIRE -32 32 -48 32
WIRE 144 32 48 32
WIRE 384 32 336 32
WIRE 2352 32 2352 -80
WIRE 2384 32 2352 32
WIRE 2496 32 2496 -80
WIRE 2496 32 2448 32
WIRE -672 48 -704 48
WIRE -1216 96 -1216 32
WIRE -704 96 -704 48
WIRE 384 96 336 96
WIRE 512 96 512 64
WIRE 512 96 448 96
WIRE 512 128 512 96
WIRE -1440 144 -1440 0
WIRE -1008 144 -1440 144
WIRE -736 144 -736 16
WIRE -736 144 -928 144
WIRE 944 144 896 144
WIRE 1072 144 1072 16
WIRE 1072 144 1024 144
WIRE 1104 144 1072 144
WIRE 384 160 336 160
WIRE 1248 160 1248 16
WIRE 1248 160 1168 160
WIRE 1328 160 1248 160
WIRE 2016 160 1952 160
WIRE 2048 160 2016 160
WIRE 2176 160 2128 160
WIRE 2208 160 2176 160
WIRE 2352 160 2352 32
WIRE 2352 160 2288 160
WIRE 2384 160 2352 160
WIRE 384 176 384 160
WIRE 1104 176 1072 176
WIRE 2496 176 2496 32
WIRE 2496 176 2448 176
WIRE 2592 176 2496 176
WIRE 2384 192 2352 192
WIRE 240 208 240 192
WIRE 1072 208 1072 176
WIRE 2016 224 2016 160
WIRE 2352 224 2352 192
WIRE 2016 320 2016 304
WIRE 2176 320 2176 160
WIRE 2176 320 2016 320
WIRE 2016 336 2016 320
WIRE -1776 432 -1776 400
WIRE -1632 432 -1632 400
WIRE 2016 448 2016 416
WIRE -1776 560 -1776 512
WIRE -1632 560 -1632 512
WIRE -1024 688 -1136 688
WIRE -624 688 -736 688
WIRE -160 688 -272 688
WIRE -1136 736 -1136 688
WIRE 1680 768 1632 768
WIRE 1792 768 1760 768
WIRE 1056 784 960 784
WIRE -1392 864 -1536 864
WIRE 992 864 992 848
WIRE -736 880 -736 688
WIRE 1632 880 1632 768
WIRE 1680 880 1632 880
WIRE 1792 880 1792 768
WIRE 1792 880 1744 880
WIRE -1136 896 -1136 816
WIRE -1136 896 -1248 896
WIRE 1056 896 1056 784
WIRE -1536 912 -1536 864
WIRE -1392 928 -1440 928
WIRE 624 960 592 960
WIRE 736 960 688 960
WIRE 864 960 816 960
WIRE 960 960 864 960
WIRE 1248 960 1184 960
WIRE -1392 992 -1392 960
WIRE 864 992 864 960
WIRE 1632 1008 1632 880
WIRE 1632 1008 1600 1008
WIRE 1680 1008 1632 1008
WIRE -1536 1024 -1536 992
WIRE -1440 1024 -1440 928
WIRE 1792 1024 1792 880
WIRE 1792 1024 1744 1024
WIRE 1904 1024 1792 1024
WIRE 2000 1024 1904 1024
WIRE 1680 1040 1632 1040
WIRE 1904 1040 1904 1024
WIRE 992 1072 992 1056
WIRE 1024 1072 1024 1040
WIRE 1040 1072 1024 1072
WIRE 1056 1072 1056 1024
WIRE 1056 1072 1040 1072
WIRE 1632 1072 1632 1040
WIRE -736 1088 -736 960
WIRE -272 1088 -272 688
WIRE 864 1104 864 1072
WIRE 1040 1104 1040 1072
WIRE 1904 1136 1904 1120
WIRE -1440 1152 -1440 1104
WIRE 864 1200 864 1168
WIRE -736 1232 -736 1168
WIRE -272 1232 -272 1168
WIRE -1440 1296 -1440 1232
WIRE -1440 1312 -1440 1296
WIRE -1440 1408 -1440 1376
FLAG -1472 0 INPUT3
IOPIN -1472 0 In
FLAG -1152 -16 V+
FLAG -1152 48 V-
FLAG -432 32 ABS
IOPIN -432 32 Out
FLAG -640 0 V+
FLAG -640 64 V-
FLAG -1216 96 0
FLAG -704 96 0
FLAG -1776 560 0
FLAG -1632 560 0
FLAG -1776 400 V+
FLAG -1632 400 V-
FLAG -160 688 INPUT
IOPIN -160 688 Out
FLAG -272 1232 0
FLAG -144 32 ABS
IOPIN -144 32 In
FLAG 384 32 RMS
IOPIN 384 32 Out
FLAG -624 688 INPUT2
IOPIN -624 688 Out
FLAG -736 1232 0
FLAG 1136 128 V+
FLAG 1136 192 V-
FLAG 1072 208 0
FLAG 896 144 RMS
IOPIN 896 144 In
FLAG 1328 160 THRESHOLD
IOPIN 1328 160 Out
FLAG 992 848 V+
FLAG 1040 1104 0
FLAG 992 1072 V-
FLAG 960 784 GAIN
IOPIN 960 784 In
FLAG 1248 960 VCA
IOPIN 1248 960 Out
FLAG 592 960 INPUT3
IOPIN 592 960 In
FLAG 2352 224 0
FLAG 2416 144 V+
FLAG 2416 208 V-
FLAG 2160 -416 V+
FLAG 832 -320 V+
FLAG 2160 -112 V-
FLAG 832 -16 V-
FLAG 1952 160 THRESHOLD
IOPIN 1952 160 In
FLAG 2592 176 GAIN
IOPIN 2592 176 Out
FLAG 384 176 0
FLAG 512 -16 V+
FLAG 240 -16 V+
FLAG 240 208 V-
FLAG 1632 1072 0
FLAG 1600 1008 VCA
IOPIN 1600 1008 In
FLAG 1712 992 V+
FLAG 1712 1056 V-
FLAG 1904 1136 0
FLAG 864 1200 0
FLAG 512 128 0
FLAG 2016 448 0
FLAG 2000 1024 Output
IOPIN 2000 1024 Out
FLAG -1024 688 INPUT3
IOPIN -1024 688 Out
FLAG -1392 992 0
FLAG -1536 1024 0
FLAG -1440 1408 0
SYMBOL OpAmps\\OP1177 -1152 -48 R0
SYMATTR InstName U1
SYMBOL OpAmps\\OP1177 -640 -32 R0
SYMATTR InstName U2
SYMBOL res -912 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 20k
SYMBOL res -768 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res -576 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 20k
SYMATTR SpiceLine tol=1
SYMBOL res -1136 -240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL diode -944 0 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode -1120 -144 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL res -1312 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL voltage -1776 416 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL voltage -1632 416 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value -12
SYMBOL voltage -272 1072 R0
SYMATTR InstName V5
SYMATTR Value wavefile=test_audio_signal.wav
SYMBOL voltage -736 1072 R0
SYMATTR InstName V7
SYMATTR Value wavefile=test_audio_signal.wav
SYMBOL bv -736 864 R0
SYMATTR InstName B2
SYMATTR Value V=(white(2e6*time)/100)
SYMBOL OpAmps\\OP1177 1136 96 R0
SYMATTR InstName U4
SYMBOL diode 1168 -128 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL diode 1232 -192 R0
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL cap 1184 0 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 22p
SYMBOL res 1216 -224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL res 1040 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 5.1k
SYMBOL res 832 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 20k
SYMBOL cap 624 944 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 10µ
SYMBOL res 816 -144 R0
SYMATTR InstName R16
SYMATTR Value 0.5k
SYMBOL res 816 -304 R0
SYMATTR InstName R17
SYMATTR Value 8.5k
SYMBOL OpAmps\\OP1177 2416 112 R0
SYMATTR InstName U5
SYMBOL res 2304 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 10k
SYMBOL res 2480 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 5.1k
SYMBOL res 2336 -240 R0
SYMATTR InstName R22
SYMATTR Value 620k
SYMBOL res 2144 -240 R0
SYMATTR InstName R23
SYMATTR Value 0
SYMBOL res 2144 -400 R0
SYMATTR InstName R24
SYMATTR Value 10k
SYMBOL 4305RMS 240 96 R0
SYMATTR InstName THAT1
SYMATTR Prefix X
SYMATTR Value 4305RMS
SYMBOL 4305VCA 1056 960 R0
SYMATTR InstName THAT2
SYMATTR Prefix X
SYMATTR Value 4305VCA
SYMBOL cap -48 16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value 10µ
SYMBOL res 64 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 33k
SYMBOL cap 496 0 R0
SYMATTR InstName C8
SYMATTR Value 22µ
SYMBOL OpAmps\\OP1177 1712 960 R0
SYMATTR InstName U3
SYMBOL cap 1744 864 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 22p
SYMBOL res 1776 752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL res 1888 1024 R0
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL res 848 976 R0
SYMATTR InstName R15
SYMATTR Value 6.2k
SYMBOL cap 848 1104 R0
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL cap 2448 16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL cap 448 80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 10µ
SYMBOL res 2144 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 1.43k
SYMBOL res 2032 320 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R21
SYMATTR Value 0
SYMBOL res 2032 432 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R25
SYMATTR Value 10k
SYMBOL res 1008 -176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 430k
SYMBOL SpecialFunctions\\modulate -1392 864 R0
WINDOW 3 -265 -32 Left 2
SYMATTR Value mark=1k,space=0.1k
SYMATTR InstName A1
SYMBOL voltage -1440 1008 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PULSE(0 1 10m 1p 1p 10m 20m)
SYMBOL voltage -1536 896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 1
SYMBOL voltage -1440 1136 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value PULSE(0 1 20m 1p 1p 20m 40m)
SYMBOL voltage -1440 1280 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value PULSE(0 1 40m 1p 1p 40m 80m)
SYMBOL bv -1136 720 R0
SYMATTR InstName B1
SYMATTR Value V=(white(2e6*time)/100)
TEXT -768 1320 Left 2 !.tran 0.1
TEXT -3576 208 Left 2 !.SUBCKT 4305RMS RMS_IN CT RMS_OUT GND V- V+\n*\nQ_Q6         2 1 RMS_IN QPNPRMS\nQ_Q10        3 3 4 QPNPRMS\nF_F5         CT V- VF_F5 1\nVF_F5        5 V- 0V\nF_F3         6 V- VF_F3 1\nVF_F3        2 V- 0V\nF_F4         V+ 7 VF_F4 1\nVF_F4        V+ 6 0V\nI_I1         8 V- DC 3.2uA\nF_F2         V+ 2 VF_F2 1\nVF_F2        V+ 9 0V\nQ_Q9         V+ 0 4 QNPNRMS\nQ_Q3         9 10 RMS_IN QNPNRMS\nE_E1         V+ 10 V+ 11 1\nG_G1         11 0 12 13 6.154e-6\nR_R1         0 11  22Meg\nI_I2         14 5 DC 7.5uA\nQ_Q1         13 RMS_IN 8 QNPNRMS 1\nR_R4         12 V+  162.5k\nR_R3         13 V+  162.5k\nC_C1         0 11  4pF\nE_E2         10 1 0 3 1\nE_E3         15 16 V+ 14 1\nE_E5         RMS_OUT 15 CT 15 1\nQ_Q2         12 GND 8 QNPNRMS 1\nE_E6         15 0 GND 0 1\nQ_Q4         7 17 18 QNPNRMS 4\nQ_Q7         19 16 18 QPNPRMS 4\nQ_Q5         14 14 V+ QPNPRMS 4\nR_R6         17 7  700\nR_R7         19 16  700\nE_E4         20 15 7 15 1\nQ_Q8         V+ 20 CT QNPNRMS 4\nI_I4         3 V- DC 40nA\nI_I5                 V+ V- 370uA\n.MODEL QNPNRMS NPN IS=1e-15 BF=200 VAF=800 CJC=.19pF RB=220\n.MODEL QPNPRMS PNP IS=1e-15 BF=75 VAF=80 CJC=.53pF RB=205\n.ENDS
TEXT -2656 208 Left 2 !.SUBCKT 4305VCA VCA_IN VCA_OUT EC- EC+ V+ V- GND\n*\nR_R11        22 20  30\nR_R9         EC+ 34  30\nQ_Q35        20 22 24 QNPNVCA\nQ_Q42        30 30 31 QNPNVCA\nV_V6         1 2 DC 1.4V\nD_D5         1 V+ DNOM\nQ_Q43        0 0 31 QPNPVCA\nQ_Q33        12 9 10 QNHIB\nV_V7         2 3 DC .7V\nI_I1         10 V- DC 7.0uA\nG_G7         28 V- 40 V- 100e-6\nE_E1         20 28 30 0 2\nQ_Q39        28 28 27 QPNPVCA\nQ_Q36        VCA_OUT 34 27 QNPNVCA\nR_R36        V- 28  100Meg\nQ_Q38        28 28 26 QPNPVCA\nI_I9         20 28 DC 130uA\nQ_Q41        VCA_OUT EC- 24 QPNPVCA\nV_V5         GND 40 DC 1.8V\nR_R10        EC- 25  30\nV_Vos        9 GND DC 3mV\nD_D6         GND 3 DNOM\nC_C3         20 0  4.7pF\nR_R12        21 20  30\nG_G5         V+ 2 11 12 33.65e-6\nR_R35        12 V+  15k\nR_R34        11 V+  15k\nR_R29        GND 2  25Meg\nG_G6         V+ 20 2 GND 2.3e-3\nC_C4         GND 2 16pF\nQ_Q37        20 21 23 QNPNVCA\nI_I8         28 V- DC 950uA\nI_I10        V+ 6 DC 100uA\nD_D7         6 V- DNOM\nI_I11        V+ 7 DC 100uA\nD_D8         7 V- DNOM\nQ_Q40        VCA_IN EC+ 23 QPNPVCA\nQ_Q34        VCA_IN 25 26 QNPNVCA\nQ_Q32        11 VCA_IN 10 QNHIB\nG_G8         VCA_IN V- 6 7 40e-5\nI_I2         0 30 DC 22uA\nI_Isym       0 34 DC 4.4uA\nV_V9                 V+ 4 2.8V\nR_R40                4 V- 40k\n.model DNOM D Is=1e-14 Cjo=.1pF Rs=.1\n.model QNHIB NPN BF=2000\n.model QNPNVCA NPN IS=5e-16 BF=150 VAF=150 RB=45 CJC=1.0pF\n.model QPNPVCA PNP IS=5e-16 BF=75 VAF=100 RB=100 CJC=1.1pF\n.ENDS
TEXT 1664 1224 Left 4 ;Output Buffer
TEXT 648 1272 Left 4 ;Voltage Controlled Amplifier
TEXT 2280 352 Left 4 ;Makeup Gain
TEXT 952 304 Left 4 ;Threshold Detector
TEXT 56 304 Left 4 ;RMS Detector
TEXT -1296 272 Left 4 ;Precision Full Bridge Rectifier
